<!doctype html>
<html ng-app>
 <head>
  <title>Jukeberry</title>
  <link rel="stylesheet" type="text/css" href="{{url_for('static',filename='raspi.css')}}" />
  <link rel="stylesheet" type="text/css" href="{{url_for('static',filename='jukeberry.css')}}" />
  <style>
  </style>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.7/angular.min.js"></script>
  <script>
    function JukeCtrl($scope,$http) {
        $scope.play = function(artist,title) {
            var data = {'artist':artist,'title':title};
            var url = '{{url_for('add')}}';
            var method = 'POST';
            $http(
                {method: method, url: url,data: JSON.stringify(data)}
            ).success(function(data, status) {
                gotPlay(data,status);
            }).error(function(data, status) {
                gotPlay(data,status);
            });
        };
        $scope.get_songs = function() {
            var url = '{{url_for('get_songlist')}}';
            var method = 'GET';
            $http(
                {method: method, url: url}
            ).success(function(data, status) {
                gotSongs(data,status);
            }).error(function(data, status) {
                gotSongs(data,status);
            });
        };
    }
  </script>
 </head>
 <body>
  <div id='raspi'>
    <div class='view'>Artist</div><!-- id='view' -->
    <div class='frame'>
      {% for l in list('#ABCDEFGHIJKLMNOPQRSTUVWXYZ') %}
       <div class='tile'>{{l}}</div>
      {% endfor %}
    </div><!-- class='frame' -->
  </div><!-- id='raspi' -->
  <div id='head'>
   <div id='title'>Jukeberry</div>
  </div><!-- id='head' -->
  <div id='body'>
   <div ng-controller="JukeCtrl">
    <div id='currsong' class='section'>
     <span class='label'>Currently Playing:</span> 
    {% if currsong is none %}
        Nothing!
    {% else %}
        <span class='name'>{{currsong.title}}</span> by <span class='artist'>{{currsong.artist}}</span>
    {% endif %}
    </div><!-- id='currsong' -->
    <div id='playlist' class='section'>
     <span class='label'>Next Up:</span>
     {% if playlist|length == 0 %}
       Nothing!
     {% elif playlist|length == 1 %}
          <span class='name'>{{playlist[0].title}}</span> by <span class='artist'>{{playlist[0].artist}}</span>
     {% else %}
      <ol>
       {% for song in playlist %}
          <li><span class='name'>{{song.title}}</span> by <span class='artist'>{{song.artist}}</span></li>
       {% endfor %}
      </ol>
     {% endif %}
    </div><!-- id='playlist' -->
    <div id='songlist' class='section'>
     <div class='label'>Select a song:</div>
     <table>
      {% for songs in songlist.values() %}
        {% for song in songs %}
         <tr>
           <td><span class='artist'>{{song.artist}}</span></td>
           <td><span class='name clickable' ng-click='play({{json.dumps(song.artist)}},{{json.dumps(song.title)}})'>{{song.title}}</span></td>
         </tr>
        {% endfor %}
      {% endfor %}
     </table>
    </div><!-- id='songlist' -->
   </div>
  </div><!-- id='body' -->
  <script>
 function clearElements(element) {
    var len = element.childNodes.length;
    for (var cIdx = 0; cIdx < len; cIdx++) {
        element.removeChild(element.firstChild);
    }
 }

    function gotPlay(obj,txt) {
        console.log(obj);
        console.log(txt);
    }

    function gotSongs(obj,txt) {
        console.log(obj);
        var div = document.getElementById('songlist');
        clearElements(div);
        var table = document.createElement('table');
        div.appendChild(table);
        for (artist in obj) {
            for (sidx in obj[artist]) {
                var song = obj[artist][sidx];
                var row = table.insertRow(-1);
                var aCell = row.insertCell(-1);
                var sCell = row.insertCell(-1);
                aCell.appendChild(document.createTextNode(artist));
                sCell.appendChild(document.createTextNode(song.title));
            }
        }
    }

  </script>
 </body>
</html>
