<!doctype html>
<html ng-app>
 <head>
  <style>
 .clickable {
    cursor:pointer;
    color:blue;
 }
 .clickable:hover {
    color:red;
    text-decoration:underline;
 }
  </style>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.7/angular.min.js"></script>
  <script>
    function JukeCtrl($scope,$http) {
        $scope.play = function(artist,title) {
            var data = {'artist':artist,'title':title};
            var url = '{{url_for('add')}}';
            var method = 'POST';
            $http(
                {method: method, url: url,data: JSON.stringify(data)}
            ).success(function(data, status) {
                gotPlay(data,status);
            }).error(function(data, status) {
                gotPlay(data,status);
            });
        };
        $scope.get_songs = function() {
            var url = '{{url_for('get_songlist')}}';
            var method = 'GET';
            $http(
                {method: method, url: url}
            ).success(function(data, status) {
                gotSongs(data,status);
            }).error(function(data, status) {
                gotSongs(data,status);
            });
        };
    }
  </script>
 </head>
 <body>
  <div ng-controller="JukeCtrl">
   <div id=songlist>
    <table>
     {% for songs in songlist.values() %}
     {% for song in songs %}
     <tr>
        <td><span class='artist'>{{song.artist}}</span></td>
        <td><span class='title clickable' ng-click="play('{{song.artist}}','{{song.title}}')">{{song.title}}</span></td>
     </tr>
     {% endfor %}
     {% endfor %}
    </table>
   </div>
  </div>
  <script>
 function clearElements(element) {
    var len = element.childNodes.length;
    for (var cIdx = 0; cIdx < len; cIdx++) {
        element.removeChild(element.firstChild);
    }
 }

    function gotPlay(obj,txt) {
        console.log(obj);
        console.log(txt);
    }

    function gotSongs(obj,txt) {
        console.log(obj);
        var div = document.getElementById('songlist');
        clearElements(div);
        var table = document.createElement('table');
        div.appendChild(table);
        for (artist in obj) {
            for (sidx in obj[artist]) {
                var song = obj[artist][sidx];
                var row = table.insertRow(-1);
                var aCell = row.insertCell(-1);
                var sCell = row.insertCell(-1);
                aCell.appendChild(document.createTextNode(artist));
                sCell.appendChild(document.createTextNode(song.title));
            }
        }
    }

  </script>
 </body>
</html>
