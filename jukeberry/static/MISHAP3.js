if(typeof MISHAP=='undefined')MISHAP={};if(typeof console=='undefined')console={log:function(){return;}};MISHAP.site="";MISHAP.protocol=document.location.protocol;MISHAP.thisurl=window.location.href.replace(/\?.*$/,"").replace(/\#.*$/,"").replace(/\/$/,""),MISHAP.secure=function(){MISHAP.protocol="https:";return MISHAP;};MISHAP.unsecure=function(){MISHAP.protocol="http:";return MISHAP;};MISHAP.isArray=function(a){return Object.prototype.toString.call(a)==='[object Array]';};MISHAP.isString=function(a){return Object.prototype.toString.call(a)==='[object String]';};MISHAP.isObject=function(a){return Object.prototype.toString.call(a)==='[object Object]';};MISHAP.isFunction=function(a){return Object.prototype.toString.call(a)==='[object Function]';};if(!MISHAP)var MISHAP={};if(!MISHAP.AJAX)MISHAP.AJAX={};MISHAP.AJAX.isBETA=0;MISHAP.AJAX.normalizeForIE=function(){if(window.ActiveXObject&&!window.XMLHttpRequest)window.XMLHttpRequest=function(){var a=new Array('Msxml2.XMLHTTP.5.0','Msxml2.XMLHTTP.4.0','Msxml2.XMLHTTP.3.0','Msxml2.XMLHTTP','Microsoft.XMLHTTP');for(var b=0;b<a.length;b++)try{return new ActiveXObject(a[b]);}catch(c){}return null;};};MISHAP.AJAX.getJSON=function(a,b,c,d){var e=new XMLHttpRequest();e.onreadystatechange=function(){if(e.readyState==4)if(e.status==200)if(typeof d=='undefined')c(JSON.parse(e.responseText));else c.call(d,JSON.parse(e.responseText));};e.open('POST',a,true);if(MISHAP.isString(b))e.setRequestHeader('Content-Type','application/x-www-form-urlencoded');e.send(b);};MISHAP.AJAX.getXML=function(a,b,c){var d=new XMLHttpRequest();d.onreadystatechange=function(){if(d.readyState==4)if(d.status==200)c(eval(d.responseXML));};d.open('POST',a,true);d.setRequestHeader('Content-Type','application/x-www-form-urlencoded');var e=b?'&isBETA='+MISHAP.AJAX.isBETA:'isBETA='+MISHAP.AJAX.isBETA;d.send(b+e);};MISHAP.AJAX.createSRCtag=function(a,b){if(b)a+='?'+b;var c=document.createElement('script');c.type="text/javascript";c.src=a;document.getElementsByTagName('head')[0].appendChild(c);return;};MISHAP.AJAX.require=function(a,b){if(b)a+='?'+b;var c=document.getElementsByTagName('script');for(var d=0;d<c.length;d++)if(c[d].src==a)return;return MISHAP.AJAX.createSRCtag(a);};MISHAP.AJAX.normalizeForIE();if(typeof MISHAP=="undefined")MISHAP={};MISHAP.Style=function(a){this.toString=function(){return "[object MISHAP.Style]";};this.stylerules=[];this.divid='';if(a)this.divid=a;this.addStyleRule=function(a,b){var c={sel:a,styles:b};this.stylerules.push(c);return this;};this.applyStyle=function(a){var b=document.createElement("style");b.setAttribute("type","text/css");b.id=this.divid+"stylesheet";document.getElementsByTagName("head")[0].appendChild(b);if(!a)a=this.divid;for(var c=0;c<this.stylerules.length;c++){var d=this.stylerules[c];var e=d.sel;if(a)e='#'+a+' '+e;if(!e)e='html';if(b.sheet){var f=e+"{"+d.styles.join(";")+";}";b.sheet.insertRule(f,c);}else b.styleSheet.addRule(e,d.styles.join(";"),c);}};};MISHAP.CSVToArray=function(a,b){b=(b||",");var c=new RegExp(("(\\"+b+"|\\r?\\n|\\r|^)"+"(?:\"([^\"]*(?:\"\"[^\"]*)*)\"|"+"([^\"\\"+b+"\\r\\n]*))"),"gi");var d=[[]];var e=null;while(e=c.exec(a)){var f=e[1];if(f.length&&(f!=b))d.push([]);if(e[2])var g=e[2].replace(new RegExp("\"\"","g"),"\"");else var g=e[3];d[d.length-1].push(g);}var h=d.pop();if((h.length<2)&&(d[0].length==h.length)){d.push(h);console.log('last row had same length ('+h.length+') as first');console.log(h);}return d;};Date.prototype.getAge=function(a){var b=this.getYear()-a.getYear();var c=this.getDate()-a.getDate();var d=this.getMonth()-a.getMonth();if(c<0){d--;lastmonth=(this.getMonth()+11)%12;c+=Date.getDaysInMonth(this.getYear(),lastmonth);}if(d<0){b--;d+=12;}var e={'y':b,'M':d,'d':c};return e;};Date.prototype.getAgeStr=function(a){if(parseInt(this.getHours()+this.getMinutes())==0){this.setHours(a.getHours());this.setMinutes(a.getMinutes());}var b="";var c=this.getAge(a);var d=c.y;var e=c.M;var f=c.d;var g=d*12+e;var h=parseInt((this-a)/86400000);var i=parseInt((this-a)/3600000);var j=parseInt(i%24);if(i<1){var k=parseInt((this-a)/60000);b=k+" minutes";}else if(i<50)b=i+" hours";else if(h<11){if(j>15)h++;b+=h+" days";}else if(g<3){if(j>15)h++;var l=parseInt(h/7);var m=parseInt(h%7);b=l+" weeks "+m+" days";}else if(g<18)b=e+" months "+f+" days";else{if(f>21)e++;b=d+" years "+e+" months";}if((this-a)<0)return "";return b;};function str2date(a){if(!a)return "";dateStr=a.toString();if(dateStr.match("/"))return dateStr;var b=dateStr.substring(0,4);var c=dateStr.substring(4,6);var d=dateStr.substring(6,8);var e=c+"/"+d+"/"+b;return e;}function str2time(a){if(!a)return "";timeStr=a.toString();if(timeStr.match(":"))return timeStr;var b=timeStr.substring(0,2);var c=timeStr.substring(2,4);var d=timeStr.substring(4,6);var e="am";if(b>11)e="pm";if(b>12)b=b-12;if(b==0)b=12;var f=b+":"+c+":"+d+" "+e;return f;}function date2Date(a){if(!a)return "";slashdate=MISHAP.str2slashdate(a);var b=new Date(slashdate);return b;}function time2int(a){a=a.toString();if(a.match(/^[\.\d]+$/))return a;var b=a.split(/\:/);var c=parseInt(b[0])||0;var d=parseInt(b[1])||0;var e=parseInt(b[2])||0;if((c==12)&&(a.match(/am/i)))c=0;if(a.match(/pm/i))c+=12;if(c==24)c=12;var f=(c*10000)+(d*100)+e;return f;}function datediff(a,b){var c=a.split(/\./);var d=b.split(/\./);var e=c[0];var f=c[1];var g=d[0];var h=d[1];var i=e.substr(0,4);var j=e.substr(4,2);var k=e.substr(6,2);var l=g.substr(0,4);var m=g.substr(4,2);var n=g.substr(6,2);var o=f.substr(0,2);var p=f.substr(2,2);var q=f.substr(4,2);var r=h.substr(0,2);var s=h.substr(2,2);var t=h.substr(4,2);var u=new Date(j+"/"+k+"/"+i+" "+o+":"+p+":"+q);var v=new Date(m+"/"+n+"/"+l+" "+r+":"+s+":"+t);var w=v-u;var x=w/1000;var y=0;var z=0;var A=0;var B=x;if(x>3599){y=parseInt(x/3600);x=x-(3600*y);}if(x>59){z=parseInt(x/60);x=x-(60*z);}A=x;diff=y+" hours, "+z+" minutes, "+A+" seconds!";return diff;}function msec2str(a){var b=a/1000;var c=0;var d=0;var e=0;var f=b;if(b>3599){c=parseInt(b/3600);b=b-(3600*c);}if(b>59){d=parseInt(b/60);b=b-(60*d);}e=b;diff=c+" hours, "+d+" minutes, "+e+" seconds!";return diff;}function msecdiff(a,b){var c=a.split(/\./);var d=b.split(/\./);var e=c[0];var f=c[1];var g=d[0];var h=d[1];var i=e.substr(0,4);var j=e.substr(4,2);var k=e.substr(6,2);var l=g.substr(0,4);var m=g.substr(4,2);var n=g.substr(6,2);var o=f.substr(0,2);var p=f.substr(2,2);var q=f.substr(4,2);var r=h.substr(0,2);var s=h.substr(2,2);var t=h.substr(4,2);var u=new Date(j+"/"+k+"/"+i+" "+o+":"+p+":"+q);var v=new Date(m+"/"+n+"/"+l+" "+r+":"+s+":"+t);var w=v-u;return w;}Date.monthdata=[{name:"January",days:31},{name:"February",days:28},{name:"March",days:31},{name:"April",days:30},{name:"May",days:31},{name:"June",days:30},{name:"July",days:31},{name:"August",days:31},{name:"September",days:30},{name:"October",days:31},{name:"November",days:30},{name:"December",days:31}];Date.getMonthNameArray=function(){var a=[];for(var b=0;b<Date.monthdata.length;b++)a.push(Date.monthdata[b].name);return a;};Date.getDayNameArray=function(){return ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];};Date.getMonthDays=function(a,b){a=parseInt(a);var c=Date.monthdata[a-1].days;if((a==2)&&(b/4==parseInt(b/4)))c++;return c;};Date.prototype.getMonthName=function(){var a=Date.getMonthNameArray();return a[this.getMonth()];};Date.prototype.getDayName=function(){var a=Date.getDayNameArray();return a[this.getDay()];};Date.prototype.toInteger=function(){var a=this.getMonth()+1;var b=this.getDate();var c=this.getFullYear();var d=(c*10000)+(a*100)+(b*1);return d;};Date.prototype.toIntegerWithTime=function(){var a=this.getMonth()+1;var b=this.getDate();var c=this.getFullYear();var d=(c*10000)+(a*100)+(b*1);var e=this.getHours();var f=this.getMinutes();var g=this.getSeconds();var h=(e*10000)+(f*100)+g;h=h.toString();if(e<10)h="0"+h;if(e<1)h="0"+h;var d=d.toString()+"."+h;return d;};Date.prototype.toSlashdate=function(){var a=this.getMonth()+1;var b=this.getDate();var c=this.getFullYear();var d=a+"/"+b+"/"+c;return d;};if(typeof MISHAP=="undefined")MISHAP={};MISHAP.Calendar=function Calendar(a,b){this.toString=function(){return "[object MISHAP.Calendar]";};if(!b)b={};this.target=a||"";this.size={height:b.height||"",width:b.width||""};this.display={day:"full",month:"full"};this.Today=new Date();this.lastClicked=this.Today;this.displayDate={month:this.Today.getMonth()+1,date:this.Today.getDate(),year:this.Today.getFullYear()};this.currView="month";this.style=b.style||"full";this.elements={};this.stylerules=[];this.setStyle=function(a){this.style=a;if(a=="popup"){this.display.day="terse";this.display.month="brief";}};this.setDisplay=function(a){this.display.calendar=a;if(a=="terse"){this.display.day="terse";this.display.month="terse";}};this.setSize=function(a,b){};this.addStyleRule=function(a,b){var c={sel:"#"+this._id+" "+a,styles:b};this.stylerules.push(c);return this;};this.onDateClick=function(a){};this.afterDraw=function(){return 0;};this.getDisplayDate=function(){return new Date(this.displayDate.month+"/"+this.displayDate.date+"/"+this.displayDate.year);};this.init=function(){if(MISHAP.Calendar.seq)MISHAP.Calendar.seq++;else MISHAP.Calendar.seq=1001;this._id="mishapCalendar"+MISHAP.Calendar.seq;this.addStyleRule("",["height:100%"]);this.addStyleRule(".navigation",["font-size:1em","height:7%"]);this.addStyleRule("table",["font-size:.75em","border:solid thin black","width:100%","height:93%","width:100%"]);this.addStyleRule("table thead",["height:4%"]);this.addStyleRule("table tbody",["height:16%"]);this.addStyleRule("table thead td",["border-bottom:solid thin black","font-weight:bold","text-align:center","vertical-align:middle","width:14.28%"]);this.addStyleRule("table tbody td",["cursor:pointer","border:solid 1px black","padding:.5em","vertical-align:top","text-align:center"]);this.addStyleRule("table tbody td.lastmonth",["background-color:#F0FFF0"]);this.addStyleRule("table tbody td.thismonth",["background-color:#F0F0FF"]);this.addStyleRule("table tbody td.nextmonth",["background-color:#FfF0F0"]);this.addStyleRule("table tbody td div.date",["text-align:left","width:100%"]);this.addStyleRule(".navigation .previous",["width:20%","float:left","text-align:left"]);this.addStyleRule(".navigation .monthyear",["width:60%","float:left","text-align:center"]);this.addStyleRule(".navigation .month",["width:50%","float:left","text-align:center"]);this.addStyleRule(".navigation .year",["width:50%","float:left","text-align:center"]);this.addStyleRule(".navigation .next",["width:20%","float:left","text-align:right"]);this.addStyleRule(".navigation div",["height:100%"]);this.addStyleRule(".clickable",["cursor:pointer"]);this.addStyleRule(".terse tbody td",['border-color:#FFFFFF']);this.addStyleRule(".terse tbody td.thismonth:hover",['border-color:#FF0000']);this.addStyleRule(".terse tbody td.thismonth",['background-color:#FFFFFF']);this.addStyleRule(".terse tbody td.nextmonth div",['display:none']);this.addStyleRule(".terse tbody td.lastmonth div",['display:none']);this.addStyleRule(".terse tbody td.today",['border:dashed 1px red']);this.addStyleRule(".terse tbody td div.date",["text-align:center"]);this._applyStyle();};this.draw=function(){var a=document.createElement("div");var b=document.createElement("table");a.id=this._id;b.className=this.display.calendar;b.cellPadding="0";b.cellSpacing="0";a.appendChild(b);var c=this._createNav();var d=this._createHead(b);for(var e=0;e<6;e++)var f=this._createWeek(b);a.appendChild(c);a.appendChild(b);this.target.appendChild(a);this.update();return this;};this.update=function(){var a=this.elements.month;var b=this.elements.year;var c=this.getDisplayDate();var d=c.getMonthName();if(this.display.month=='terse')d=d.substr(0,1);else if(this.display.month=='brief')d=d.substr(0,3);var e=c.getFullYear();var f=a.childNodes.length;for(var g=0;g<f;g++)a.removeChild(a.firstChild);var h=b.childNodes.length;for(var g=0;g<h;g++)b.removeChild(b.firstChild);a.appendChild(document.createTextNode(d));b.appendChild(document.createTextNode(e));this.fillCalendarWithDates();this.afterDraw();};this._createNav=function(){var a=document.createElement("div");a.className="navigation";var b=document.createElement("div");var c=document.createElement("div");var d=document.createElement("div");var e=document.createElement("div");var f=document.createElement("div");c.appendChild(d);c.appendChild(e);a.appendChild(b);a.appendChild(c);a.appendChild(f);b.Calendar=this;b.className="previous clickable";b.title="previous month";var g=(this.display.calendar=='terse')?'<':'<<';var h=(this.display.calendar=='terse')?'>':'>>';b.appendChild(document.createTextNode(g));c.Calendar=this;c.className="monthyear";d.Calendar=this;d.className="month";d.title="thismonth";e.Calendar=this;e.className="year";e.title="thisyear";this.elements.month=d;this.elements.year=e;f.Calendar=this;f.className="next clickable";f.title="next month";f.appendChild(document.createTextNode(h));b.onclick=function(){this.Calendar.displayDate.month--;this.Calendar.displayDate.date=1;if(!this.Calendar.displayDate.month){this.Calendar.displayDate.month=12;this.Calendar.displayDate.year--;}this.Calendar.update();};f.onclick=function(){this.Calendar.displayDate.month++;this.Calendar.displayDate.date=1;if(this.Calendar.displayDate.month>12){this.Calendar.displayDate.month=1;this.Calendar.displayDate.year++;}this.Calendar.update();};return a;};this._createHead=function(a){var b=document.createElement("thead");a.appendChild(b);var c=b.insertRow(-1);var d=Date.getDayNameArray();for(var e=0;e<d.length;e++){var f=d[e];var g=c.insertCell(-1);g.className=f;if(this.display.day=="brief")f=f.substr(0,3);else if(this.display.day=="terse")f=f.substr(0,1);var h=document.createElement("span");h.appendChild(document.createTextNode(f));g.appendChild(h);}return b;};this._createWeek=function(a){var b=document.createElement("tbody");a.appendChild(b);var c=b.insertRow(-1);var d=Date.getDayNameArray();for(var e=0;e<d.length;e++){var f=d[e];var g=c.insertCell(-1);var h=document.createElement("span");g.appendChild(h);g.className=f+" lastmonth";g.day=f;h.innerHTML="&nbsp;";}b.className="week";return b;};this.fillCalendarWithDates=function(){var a=Date.getMonthDays(this.displayDate.month,this.displayDate.year);var b=new Date(this.displayDate.month+"/01/"+this.displayDate.year).getDay();var c=this.target.getElementsByTagName("tbody");var d=0;for(var e=0;e<c.length;e++){var f=c[e].rows[0];for(var g=0;g<f.cells.length;g++){var h=f.cells[g];var i=h.childNodes.length;for(var j=0;j<i;j++)h.removeChild(h.firstChild);if((e==0)&&(g<b)){h.className=h.className.replace(/ ?\w\w\w\wmonth/,"");h.className+=" lastmonth";continue;}d++;displayDate=d;displayYear=this.displayDate.year;displayMonth=this.displayDate.month;if(d>a){h.className=h.className.replace(/ ?\w\w\w\wmonth/,"");h.className+=" nextmonth";displayDate=d-a;displayMonth++;if(displayMonth>12){displayMonth=1;displayYear++;}}else{h.className=h.className.replace(/ ?\w\w\w\wmonth/,"");h.className+=" thismonth";if(displayDate==this.Today.getDate())h.className+=' today';}slashdate=displayMonth+"/"+displayDate+"/"+displayYear;h.date=displayDate;var k=document.createElement("div");k.className+=" date";if(displayDate==1){mlen=3;mdis='';if(this.display.day=='brief')mlen=3;if(this.display.day!='terse')mdis=new Date(slashdate).getMonthName().substr(0,mlen)+" ";displayDate=mdis+displayDate;}k.appendChild(document.createTextNode(displayDate));h.appendChild(k);h.slashdate=slashdate;h.Calendar=this;h.onclick=function(){this.Calendar._onDateClick(this);};}}};this._onDateClick=function(a){this.lastClicked=new Date(a.slashdate);this.onDateClick(a);};this._applyStyle=function(){var a=document.createElement("style");a.setAttribute("type","text/css");a.id=this._id+"stylesheet";document.getElementsByTagName("head")[0].appendChild(a);for(var b=0;b<this.stylerules.length;b++){var c=this.stylerules[b];if(a.sheet){var d=c.sel+"{"+c.styles.join(";")+"}";a.sheet.insertRule(d,b);}else a.styleSheet.addRule(c.sel,c.styles.join(";"),b);}};this.init();return this;};function popWindow(a,b){var c=document.getElementById(a);var d=b?b:c;var e=d.offsetLeft-d.scrollLeft;var f=d.offsetTop-d.scrollTop;while((d=d.offsetParent)!=null){e+=d.offsetLeft;e-=d.scrollLeft;f+=d.offsetTop;f-=d.scrollTop;if(d.style.position=="absolute")break;}c.style.display="";c.style.position="absolute";c.style.left=e+"px";c.style.top=f+"px";return c;}function findPos(a){var b=curtop=0;if(a.offsetParent){b=a.offsetLeft;curtop=a.offsetTop;while(a=a.offsetParent){b+=a.offsetLeft;curtop+=a.offsetTop;}}return [b,curtop];}function unpopWindow(a){document.getElementById(a).style.display="none";}function getPosition(a){var b=0;var c=0;if(a!=null){try{while(a.offsetParent){b+=a.offsetLeft;if(a.offsetParent.scrollLeft)b-=a.offsetParent.scrollLeft;c+=a.offsetTop;if(a.offsetParent.scrollTop)c-=a.offsetParent.scrollTop;a=a.offsetParent;}}catch(d){}b+=a.offsetLeft+document.body.scrollLeft-document.body.clientLeft;c+=a.offsetTop+document.body.scrollTop-document.body.clientTop;}return{x:b,y:c};}if(typeof MISHAP=="undefined")MISHAP={};MISHAP.TabbedDisplay=function(){this.toString=function(){return "[object MISHAP.TabbedDisplay]";};this.targdiv;this.tabstable;this.slidesdiv;this.Slides=[];this.position="top";this.style="tabbed";this.borders="1";this.init=function(){this.initStyle();this.targdiv.className+=" tabbeddisplay "+this.style;var a=document.createElement("table");a.className+=" tabgrid "+this.position+" "+this.style;a.cellSpacing="0px";a.cellPadding="0px";var b=document.createElement("div");var c=document.createElement("table");var d=document.createElement("div");this.tabstable=c;this.slidesdiv=d;c.className+=" "+this.position;this.targdiv.className+=" "+this.position+" "+this.style;c.cellSpacing="0px";c.cellPadding="0px";b.className+=" tabgroup";d.className+=' tabSlides';var e;var f;if(this.position=="left"){var g=a.insertRow(-1);e=g.insertCell(-1);f=g.insertCell(-1);}else{var g=a.insertRow(-1);var h=a.insertRow(-1);e=g.insertCell(-1);f=h.insertCell(-1);}e.className+=' '+this.position+" tabsCell"+" "+this.style;e.appendChild(b);f.className+=" slidesCell";b.appendChild(c);f.appendChild(d);this.targdiv.appendChild(a);c.insertRow(-1);};this.addSlide=function(a){var b=a.label;var c=a.slideid||"slide"+b.replace(/\s+/g,"");var d=a.slide||document.getElementById(c)||document.createElement('div');var e=a.onclick||function(){return 0;};var f="tab"+b.replace(/\s+/g,"");var g="tablink"+b.replace(/\s+/g,"");var h=this.tabstable.rows[0];if(this.position=="left")h=this.tabstable.insertRow(-1);else{}var i=h.insertCell(-1);i.className+=" tab";var j=document.createElement('div');var k=document.createElement('a');j.className+=' tab';j.id=f;k.href="javascript:void(0)";k.className+=" tab tablink tablabel";k.appendChild(document.createTextNode(b));j.appendChild(k);i.appendChild(j);this.slidesdiv.appendChild(d);d.className+=' slide';d.id=c;d.tab=i;d.activate=function(){this.tab.onclick();};i.slide=d;i.link=k;i.Slides=this.Slides;i.afterclick=e;i.onclick=this._onclickTab;this.Slides.push({"label":b,"tab":i,"slide":d,"onclick":e});return d;};this.activateSlide=function(a){for(var b=0;b<Slides.length;b++){Slides[b].tab.className+=Slides[b].tab.className.replace(/ ?disabled/ig,"");if(a!=b)Slides[b].tab.className+=" disabled";}Slides[a].tab.onclick();};this.getSlideByLabel=function(a){for(var b=0;b<this.Slides.length;b++)if(this.Slides[b].label==a)return this.Slides[b];return 0;};this._onclickTab=function(){if(this.className.match(/disabled/))return;for(var a=0;a<this.Slides.length;a++){var b=this.Slides[a].tab;if(b)b.className=b.className.replace(/ ?selected/g,"");var c=this.Slides[a].slide;if(c)c.style.display="none";}this.className+=" selected";this.slide.style.display="";this.link.blur();this.afterclick();};this.initStyle=function(){if(typeof (MISHAP.Style)=='undefined')return;this.Style=new MISHAP.Style();this.Style.addStyleRule(".tabbeddisplay .tabgrid td.left",["vertical-align: top"]);this.Style.addStyleRule(".tabbeddisplay .tabgroup .top",["bottom: -1px","padding: 0px 8px 0px 0px","margin: 0px","position: relative","z-index: 2"]);this.Style.addStyleRule(".tabbeddisplay .tabgroup .left",["padding: 0px 0px 8px 0px","margin: 0px","position: relative","z-index: 2"]);this.Style.addStyleRule(".tabbeddisplay .tabbed .tabgroup .left",["right: -1px"]);this.Style.addStyleRule(".tabbeddisplay .tabgroup .top td",["vertical-align: bottom","border: 0px none","margin: 0px","padding: 0px"]);this.Style.addStyleRule(".tabbeddisplay .tabgroup .left td",["border: 0px none","margin: 0px","padding: 0px"]);this.Style.addStyleRule(".tabbeddisplay .tabbed .tabgroup .left td",["text-align: right"]);this.Style.addStyleRule(".tabbeddisplay .tabgroup .top .tab",["margin: 0px","padding: 0px 0px 0px 8px"]);this.Style.addStyleRule(".tabbeddisplay .tabgroup .left .tab",["margin: 0px","padding: 8px 0px 0px 0px"]);this.Style.addStyleRule(".tabbeddisplay .tabgroup .tab a",["text-decoration: none","display: block","white-space: nowrap"]);this.Style.addStyleRule(".tabbeddisplay .tab a",["border: solid 1px #C0C0C0","background: #F0F0F0"]);this.Style.addStyleRule(".tabbeddisplay .tabgroup .left .tab a",["border-bottom-color: black"]);this.Style.addStyleRule(".tabbeddisplay .tabgroup .top .tab a",["border-right-color: black"]);this.Style.addStyleRule(".tabbeddisplay .tabgroup .top .tab a",["padding-top: 1px","padding-right: 0.5em","padding-left: 0.5em","padding-bottom: 2px","vertical-align: text-bottom","margin-bottom: 0px"]);this.Style.addStyleRule(".tabbeddisplay .tabgroup .left .tab a",["padding-left: 9px","padding-top: 0.5em","padding-bottom: 0.5em","padding-right: 10px","vertical-align: text-bottom","margin-right: 0px"]);this.Style.addStyleRule(".tabbeddisplay .tabgroup .top .selected a",["border-bottom: solid 1px white","background: white"]);this.Style.addStyleRule(".tabbeddisplay .tabbed .tabgroup .left .selected a",["border-right: solid 1px white","background: white"]);this.Style.addStyleRule(".tabbeddisplay .tabSlides",["padding: 5px","border: solid 1px #C0C0C0","z-index: 1"]);this.Style.addStyleRule(".tabbeddisplay .tabgroup .disabled a",["cursor: not-allowed","background: #C0C0C0"]);};return this;};if(typeof MISHAP=='undefined')MISHAP={};if(typeof (MISHAP.PageData)=='undefined')MISHAP.PageData={};MISHAP.PageData.toString=function(){return "[object MISHAP.PageData]";};MISHAP.PageData.iconpath="/icons/shared";MISHAP.PageData.data=[];MISHAP.PageData.divids=[];MISHAP.PageData.vieweditdiv="";MISHAP.PageData.statusdelay=5;MISHAP.PageData.fileattr='_files';MISHAP.PageData.tagName={'bardiv':'bardiv','contentdiv':'content'};MISHAP.PageData.geticonpath=function(){return this.iconpath;};MISHAP.PageData.saveimgsrc="/media-floppy.gif";MISHAP.PageData.saveurl="/cgi-bin/savepagedata";MISHAP.PageData.geturl="/js-bin/getpagedata";MISHAP.PageData.regex={'file':{'img':/^(image\/bmp|image\/cis-cod|image\/gif|image\/ief|image\/jpeg|image\/jpeg|image\/jpeg|image\/pipeg|image\/png|image\/svg\+xml|image\/tiff|image\/x-cmu-raster|image\/x-cmx|image\/x-icon|image\/x-portable-anymap|image\/x-portable-bitmap|image\/x-portable-graymap|image\/x-portable-pixmap|image\/x-rgb|image\/x-xbitmap|image\/x-xpixmap|image\/x-xwindowdump)$/i}};MISHAP.PageData.init=function(){for(var a=0;a<MISHAP.PageData.divids.length;a++){var b=document.getElementById(MISHAP.PageData.divids[a]);if(b)MISHAP.PageData.initDiv(b);}};MISHAP.PageData.prepTarg=function(a){var b=a.dataobj;var c=a.targdiv;var d=a.style||"";if(!c)c=b.targdiv;if(!c)return 0;if(!b.targdiv)b.targdiv=c;c.dataobj=b;c.style.display="";c.className=c.className.replace(/ ?edit| ?view/g,"");c.className+=" "+d;var e=c.getElementsByTagName("bardiv")[0];if(e){e.className=e.className.replace(/ ?edit| ?view/g,"");e.className+=" "+d;e.dataobj=b;}var f=c.getElementsByTagName("content")[0]||c;f.className+=' content';b.contentdiv=f;b.displaydiv=f;f.dataobj=b;MISHAP.PageData.clearElements(f);return f;};MISHAP.PageData.initDiv=function(a){if(!a.className.match("PageData"))a.className+=" PageData";var b=a.getElementsByTagName("bardiv")[0];var c=a.getElementsByTagName("content")[0];if(!b){b=document.createElement('bardiv');b.className='bardiv';}if(!c){c=document.createElement('content');c.className='content';var d=a.childNodes.length;for(var e=0;e<d;e++)c.appendChild(a.childNodes[0]);}a.appendChild(b);a.appendChild(c);a.bardiv=b;a.contentdiv=c;MISHAP.PageData.makeEditableDiv(a);return a;};MISHAP.PageData.getPageData=function(){MISHAP.AJAX.getJSON(MISHAP.PageData.geturl,"page="+escape(MISHAP.PageData.thisurl),MISHAP.PageData.gotPageData);};MISHAP.PageData.gotPageData=function(a){if(MISHAP.PageData.clearonnodata)for(var b=0;b<MISHAP.PageData.divids.length;b++){var c=document.getElementById(MISHAP.PageData.divids[b]);if(!c)continue;var d=c.getElementsByTagName("content")[0];if(!d)continue;MISHAP.PageData.clearElements(d);}if(!a)return;for(var e=0;e<a.length;e++){var f=a[e];var g=f.divid;var c=document.getElementById(g);if(!c)continue;if(!c.dataobj)MISHAP.PageData.initDiv(c);if(c.dataobj=="[object MISHAP.PageData.ObjList]"){MISHAP.PageData.gotListData([f],g);continue;}c.dataobj.data=f;var h=c.bardiv||c.getElementsByTagName("bardiv")[0];h.className=h.className.replace(/ ?view| ?edit/g,"");h.className+=" view";var i=c.contentdiv||c.getElementsByTagName("content")[0];i.className=i.className.replace(/ ?view| ?edit/g,"");i.className+=" view";c.dataobj.toHTML();}};MISHAP.PageData.addListObj=function(a){throw "MISHAP.PageData.addListObj Depricated.  use new MISHAP.PageData.ObjList(div)";};MISHAP.PageData.ongotListData=function(a,b){};MISHAP.PageData.savePageDataold=function(a){var b=a.dataobj||this.targdiv.dataobj;var c=a.saveurl||b.saveurl;var d=a.callstr2;var e=a.dataobj2||this.targdiv.dataobj;var f=a.varstr;var g=MISHAP.thisurl.replace(/^https?:\/\//g,"").replace(/\/.*/g,"");var h=c.replace(/^https?:\/\//g,"").replace(/\/.*/g,"")||g;var i=a.callback||MISHAP.PageData.onPageDataSave;var j=a.callstr||"MISHAP.PageData.onPageDataSave";var k=a.method||(g==h)?"POST":"GET";var l="page="+MISHAP.thisurl+"&json="+escape(JSON.stringify(b.data).replace(/\+/g,"%2B")).replace(/\%252B/g,"%2B");if(f)l+="&"+f;if(k=="POST")MISHAP.AJAX.getJSON(c,l,i,b);else{if(!l.match("&c="))l+="&c="+j;MISHAP.AJAX.createSRCtag(c,l);}};MISHAP.PageData.save_onclick=function(){if(this.disabled)return;var a=this.targdiv;var b=a.dataobj;if(typeof (b.checkRequired)=='function'){var c=b.checkRequired();if(!c)return false;}var d=a.statusdiv;if(!d)d=MISHAP.PageData.alertbox;if(d){MISHAP.PageData.clearElements(d);d.appendChild(document.createTextNode('Saving . . . .'));}b._edited=0;if(b.bardiv)b.bardiv.className=b.bardiv.className.replace(/ ?changed/g,"");a.className=a.className.replace(/ changed/g,"");if(typeof (b.save)=='function')b.save();else MISHAP.PageData.savePageData(b);return true;};MISHAP.PageData.genFormData=function(a){var b=null;var c=(typeof (window.FileReader)=='undefined');if(c){console.log('stupidIE');var d=[];for(var e=0;e<a.length;e++){n=a[e].name;v=a[e].value;d.push(escape(n)+'='+escape(v).replace(/\+/g,"%2B").replace(/\%252B/g,"%2B"));}b=d.join('&');}else{b=new FormData();for(var e=0;e<a.length;e++)b.append(a[e].name,a[e].value);}return b;};MISHAP.PageData.savePageData=function(a){if(!a)a=this;if(a.toString()=='[object MISHAP.PageData]'){console.log("MISHAP.PageData is not a valid dataobj");return;}var b=a.saveurl;var c=a.onSave;var d=a;if(!c){c=MISHAP.PageData.onPageDataSave;d=MISHAP.PageData;}var e=null;var f=(typeof (window.FileReader)=='undefined');if(f){console.log('stupidIE');var g='';if(typeof (a.getsavevariablestr)!='undefined')g=a.getsavevariablestr();var h="json="+escape(JSON.stringify(a.data).replace(/\+/g,"%2B")).replace(/\%252B/g,"%2B");if(g)h+="&"+g;e=h;}else{var i=MISHAP.PageData.fileattr;var j=[];if(typeof (a.getsavevariables)!='undefined')j=a.getsavevariables();var k={'name':'json','value':JSON.stringify(a.data)};j.push(k);e=new FormData();for(var l=0;l<j.length;l++)e.append(j[l].name,j[l].value);if(MISHAP.isArray(a[i])){var m=a[i];for(var l=0;l<m.length;l++){var n=m[l].value.files;for(var o=0;o<n.length;o++){var p=n[o];var q=m[l].value.textObj.datapath;e.append(q,p);}}}}MISHAP.AJAX.getJSON(b,e,c,d);};MISHAP.PageData.makeEditable=function(){for(var a=0;a<MISHAP.PageData.divids.length;a++){var b=document.getElementById(MISHAP.PageData.divids[a]);MISHAP.PageData.makeEditableDiv(b);}};MISHAP.PageData.makeEditableDiv=function(a){var b=a.bardiv||a.getElementsByTagName("bardiv")[0];if(!b)return;MISHAP.PageData.clearElements(b);var c;if(a.dataobj=="[object MISHAP.PageData.ObjList]")c=MISHAP.PageData.createListBarDiv(a);else c=MISHAP.PageData.createBarDiv(a);b.appendChild(c);b.className+=" view";return a;};MISHAP.PageData.createListBarDiv=function(a){var b=document.createElement("table");b.id='buttonbardiv';b.className='buttonbardiv';var c=b.insertRow(-1);var d=c.insertCell(-1);var e=document.createElement("img");d.className="clickable add";d.targdiv=a;e.border=0;d.defaultstyle=a.dataobj.defaultstyle;e.src=this.geticonpath()+"/icon_addprofile_22x16.gif";e.alt="Add New";d.title="Add New";var f=document.createElement("span");f.appendChild(document.createTextNode(" Add"));d.onclick=function(){var a;if(this.targdiv.dataobj.style=="tabbed")var a=this.targdiv.dataobj.getSlideSelected();var b=this.targdiv.dataobj.addObj();this.targdiv.dataobj.toHTML();if(a)a.slide.activate();b.toEDIT();};d.appendChild(e);d.appendChild(f);var d=c.insertCell(-1);var g=document.createElement("img");g.height=16;g.width=16;d.className="clickable refresh";d.targdiv=a;g.border=0;d.defaultstyle=a.dataobj.defaultstyle;g.src=this.geticonpath()+"/reload.png";g.alt="refresh list with current data";d.title="Refresh list with current data.    \nDisplayed data is not neccesarily saved.";var h=document.createElement("SPAN");h.appendChild(document.createTextNode(" Refresh"));d.onclick=function(){var a=this.targdiv.dataobj.getSlideSelected();this.targdiv.dataobj.toHTML();if(a)a.tab.onclick();};d.appendChild(g);d.appendChild(h);var d=c.insertCell(-1);var i=document.createElement("IMG");i.height=16;i.width=16;d.className="clickable reload";d.targdiv=a;i.border=0;d.defaultstyle=a.dataobj.defaultstyle;i.src=this.geticonpath()+"/reload_linux.png";i.alt="reload list with current data";d.title="Reload data from server.    \nUnsaved changes will be lost.";var j=document.createElement("SPAN");j.appendChild(document.createTextNode(" Reload"));d.onclick=function(){this.targdiv.dataobj.dataObjects=[];this.targdiv.dataobj.getListData();};d.appendChild(i);d.appendChild(j);return b;};MISHAP.PageData.createBarDiv=function(a){var b=a.bardiv||a.getElementsByTagName("bardiv")[0];var c=document.createElement('div');c.id='buttonbardiv';c.className='bar';var d=document.createElement('img');d.alt="[save]";d.title="Save Changes";d.src=MISHAP.PageData.geticonpath()+MISHAP.PageData.saveimgsrc;if(a.saveimgsrc)d.src=a.saveimgsrc;if(a.dataobj)if(a.dataobj.saveimgsrc)saveimgsrc=a.dataobj.saveimgsrc;d.id='saveimg';d.targdiv=a;d.className="clickable save";d.onclick=MISHAP.PageData.save_onclick;a.saveimg=d;a.save=function(){this.saveimg.onclick();};var e=c.appendChild(document.createElement('div'));e.className="save";e.className+=" barcell";e.appendChild(d);var f=document.createElement("IMG");f.alt="view";f.title="View";f.targdiv=a;f.src=this.geticonpath()+"/video-display.gif";f.id='viewimg';f.className="clickable ";f.onclick=function(){var a=this.targdiv.bardiv||this.targdiv.getElementsByTagName("bardiv")[0];a.className=a.className.replace(/ ?view| ?edit/g,"");a.className+=" view";var b=this.targdiv.contentdiv||this.targdiv.getElementsByTagName("content")[0];b.className=b.className.replace(/ ?view| ?edit/g,"");b.className+=" view";this.targdiv.dataobj.toHTML(this.targdiv);};a.viewimg=f;var g=document.createElement("IMG");g.alt="edit";g.targdiv=a;g.title="Edit This";g.src=this.geticonpath()+"/blog.gif";g.id='editimg';g.className="clickable ";g.onclick=function(){var a=this.targdiv.bardiv||this.targdiv.getElementsByTagName("bardiv")[0];if(a.className==undefined)a.className="";a.className=a.className.replace(/ ?view| ?edit/g,"");a.className+=" edit";var b=this.targdiv.contentdiv||this.targdiv.getElementsByTagName("content")[0];if(b.className==undefined)b.className="";b.className=b.className.replace(/ ?view| ?edit/g,"");b.className+=" edit";this.targdiv.dataobj.toEDIT(this.targdiv);};a.editimg=g;var h=c.appendChild(document.createElement('div'));h.className='view';h.className+=' barcell';h.id='vieweditcell';h.appendChild(f);h.appendChild(g);return c;};MISHAP.PageData.applyEditTags=function(a){var b=a.getElementsByTagName("EDIT");var c=a.getElementsByTagName("ADDIMG");var d=a.getElementsByTagName("DELIMG");for(var e=0;e<b.length;e++){var f=b[e];f.displaydiv=a;if(!f.type)f.type="text";if(f.type=="text"){if(!f.value)f.className+=" blank";}else if(f.type=="calendar"){f.title="click to add date";f.className+=" clickable";if(!f.innerHTML){f.appendChild(document.createTextNode("click to add date"));f.className+=" blank";}}else if(f.type=="img"){MISHAP.PageData.clearElements(f);var g=document.createElement("IMG");g.src=f.src;g.className=f.className;f.appendChild(g);}else if(f.type=="upload"){f.title="click to upload";f.className+=" clickable";if(!f.value){f.appendChild(document.createTextNode("click to upload"));f.className+=" blank";}}else if(f.type=="none"){f.title="";f.className=f.className.replace(/ ?clickable/g,"");}else if(!f.value)f.className+=" blank";f.data=a.dataobj.data;f.dataobj=a.dataobj;var h=MISHAP.PageData.createeditField(f);if(f.required)h.className+=" required";if(h){MISHAP.PageData.clearElements(f);if(f.type=='taglist'){f.inputit=h;f.onclick=function(){this.inputit.focus();};f.className+=' tagdiv';var i=document.createElement('div');i.className='taglist';f.appendChild(i);}var j=document.createElement('div');j.className='context';j.id=f.id+'context';j.appendChild(document.createTextNode(f.inputdata.Context.text));j.style.color=f.inputdata.Context.color;f.contextdiv=j;if(f.inputdata.Context.hide==true){j.style.visibility='hidden';f.onmouseover=function(){this.contextdiv.style.visibility='visible';};f.onmouseout=function(){this.contextdiv.style.visibility='hidden';};f.onfocus=function(){this.contextdiv.style.visibility='visible';};f.onblur=function(){this.contextdiv.style.visibility='hidden';};}if(f.inputdata.Context.placement=='above'){f.appendChild(j);f.appendChild(h);}else if(f.inputdata.Context.placement=='below'){f.appendChild(h);f.appendChild(j);}else f.appendChild(h);if(f.inputdata.Title)h.title=f.inputdata.Title;if(f.type=='taglist'){var k=f.delim;if(h.value){var l=h.value.split(k);if(!k)l=[h.value];for(var m=0;m<l.length;m++)h.addTag(l[m]);h.value='';}}if(h.tagName.match(/^textarea$/i))MISHAP.PageData.getResizeButtons(h);}}for(var n=0;n<c.length;n++){var o=c[n];var g=document.createElement("IMG");o.className="clickable";g.src=o.src;o.appendChild(g);}for(var p=0;p<d.length;p++){var o=d[p];var g=document.createElement("IMG");g.src=o.src;o.appendChild(g);}};MISHAP.PageData.createpopup=function(a){var b=document.createElement('div');b.id=a;b.style.position='absolute';b.style.top='0px';b.style.display='none';b.style.textAlign='center';b.style.background='#FFFFFF';b.style.border='solid thin';document.getElementsByTagName('body')[0].appendChild(b);var c=new MISHAP.Calendar(b);c.display.calendar='terse';c.display.day="terse";c.display.month="brief";c.closeable=0;c.dragable=0;c.onDateClick=function(a){var b=new Date(a.slashdate);var c=b.toInteger();var d=MISHAP.PageData.calendar.inputit;d.value=c.toString();d.onchange();unpopWindow("MISHAPpopupcalendar");};c.draw();MISHAP.PageData.calendar=c;return b;};MISHAP.PageData.createeditField=function(a){if(!a.datapath){alert("Mike needs to add a datapath to this element");return;}var b="span";if(a.type=="text")b=(a.rows==1)?"input":"textarea";else if(a.type=="radio")b="form";else if(a.type=="taglist")b="input";else if(a.type=="drop")b="form";else if(a.type=="upload5"){}var c=document.createElement(b);c.textObj=a;c.changetext=function(){var a=this.textnode;if(!a)a=this;if(a.nodeName!='#text'){MISHAP.PageData.clearElements(a);a=document.createTextNode('');this.textnode=a;this.appendChild(a);}var b=this.value.toString();if(this.textObj.type=="calendar"){b='click to add date';if(this.value)b=str2date(this.value);}if(this.textObj.type.match(/^upload/))if(!this.value)b='click to upload file';a.nodeValue=b;};c.className=a.type;c.id=a.id+"input";var d='.';if(a.datapath.match(/^\[/))d='';c.value=eval("edittag.data"+d+a.datapath);if(a.type=="radio"){var e=a.options.split(/,/);for(var f=0;f<e.length;f++){var g=document.createElement("input");var h=document.createElement("span");g.type="radio";g.name=a.id+"input";g.value=e[f];g.textObj=a;g.onclick=function(){for(var a=0;a<this.form[this.name].length;a++)this.form[this.name][a].checked=(this.form[this.name][a]==this);var b=this.textObj.datapath;var c=this.value;var d='.';if(b.match(/^\[/))d='';eval("this.textObj.data"+d+b+"="+JSON.stringify(c));};g.checked=(g.value==c.value);h.appendChild(document.createTextNode(g.value));c.appendChild(g);c.appendChild(h);if(!c[g.name])c[g.name]=new Array();}}if(a.type=="drop"){var e=a.options.split(/,/);var i=document.createElement("select");i.name=a.id+"input";i.textObj=a;i.onchange=function(){for(var a=0;a<this.form[this.name].length;a++)this.form[this.name][a].checked=(this.form[this.name][a]==this);var b=this.textObj.datapath;var c=this.value;var d='.';if(b.match(/^\[/))d='';eval("this.textObj.data"+d+b+"="+JSON.stringify(c));};for(var f=0;f<e.length;f++){var j=document.createElement("option");j.type="select";j.name=a.id+"input";j.value=e[f];j.selected=(j.value==c.value);j.appendChild(document.createTextNode(e[f]));j.textObj=a;if(!c[i.name])c[i.name]=new Array();i.appendChild(j);}c.appendChild(i);}if(a.type=="upload5"){if(typeof (window.FileReader)=='undefined')console.log('Type:upload5 not supported in this browser');var k=document.createElement('input');k.type='file';k.style.position='absolute';k.style.opacity=0;k.style.width='inherit';var l='click to upload file';if(c.value)l=c.value;var m=document.createTextNode(l);k.displayNode=m;k.textnode=m;k.inputit=c;k.textObj=a;m.filesel=k;c.filesel=k;c.textnode=m;c.appendChild(k);c.appendChild(m);c.className+=' clickable';c.title='click to upload file';c.textObj=a;c.args=a.args;c.argtype=a.argtype;if(!c.textObj.uploadpage)c.textObj.delay=1;if(c.textObj.delay){var n=MISHAP.PageData.fileattr;if(!MISHAP.isArray(c.textObj.dataobj[n]))c.textObj.dataobj[n]=[];c.textObj.dataobj[n].push({'name':c.textObj.datapath,'value':c.filesel});var o=function(){this.inputit.value=this.value;};k.addEventListener("change",o,false);}else{c.uploadcallback=function(a){if(!MISHAP.PageData.onPageDataSave(a))return;var b=this.custuploadcallback(a,c);if(!b){b='';for(var d=0;d<a.data.length;d++){if(d>0)b+=';';b+=a.data[d].name;}}this.value=b;this.onchange();};var p=function(){var a=new FormData();var b=this.textObj.uploadpage;if(!b)console.log('no upload url provided');var d=this.files;for(var e=0;e<d.length;e++){var f=d[e];a.append(f.name,f);}MISHAP.AJAX.getJSON(b,a,c.uploadcallback,c);};k.addEventListener("change",p,false);}}if(a.type=="upload"){if(typeof (window.FileReader)=='undefined'){}c.title="click to upload file";var q=a.uploadpage||"/upload.html";var r="";c.args=a.args;c.argtype=a.argtype;c.onclick=function(){var a="";var b="#"+this.id+"."+this.args;var c="?divid="+this.id+"&"+this.args;if(this.argtype=="hash")a=b;else if(this.argtype=="get")a=c;else a=c+b;var d=window.open(q+a,"UploadWindow","toolbar=no,width=500,height=75,directories=no,status=no,scrollbars=no,resizable=yes,menubar=no");};}if(c.tagName.match(/textarea/i)){c.cols=a.size;c.rows=a.rows;}else c.size=a.size;if(a.width){a.style.width=a.width;if(!a.inputwidth){var s=a.width.match(/^(\d*)(\w*)$/);var t=s[1]-6;t+=s[2];c.style.width=t;}}if(a.inputwidth)c.style.width=a.inputwidth;if(c.tagName.match(/span/i))c.changetext();else{}if(c.value=="undefined"){c.value=a.value||"";var d='.';if(a.datapath.match(/^\[/))d='';eval("edittag.data"+d+a.datapath+" = inputit.value;");}if(a.type=="calendar"){var u=document.getElementById('MISHAPpopupcalendar');if(!u)MISHAP.PageData.createpopup('MISHAPpopupcalendar');c.onclick=function(){var b=popWindow("MISHAPpopupcalendar",a);if(MISHAP.PageData.calendar)MISHAP.PageData.calendar.inputit=c;};}if((a.displaydiv)&&!(a.displaydiv.className))a.displaydiv.className="";a.displaydiv.className=a.displaydiv.className.replace(/ ?changed/g,"");if(a.dataobj._edited)a.displaydiv.className+=" changed";c.custonchange=a.inputdata.OnChange;c.custuploadcallback=a.inputdata.OnFileUpload;c.addTag=function(a){var b=document.createElement('div');var c=document.createElement('img');var d=document.createElement('span');d.appendChild(document.createTextNode(a));b.appendChild(d);b.appendChild(c);b.className='tag';c.src=MISHAP.PageData.geticonpath()+'/failed-sm.gif';c.className='clickable';c.inputdiv=this;c.tagdiv=b;c.value=a;c.onclick=function(a){var b=this.inputdiv.textObj.delim;if(!b)return;var c='.';if(this.inputdiv.textObj.datapath.match(/^\[/))c='';var d=eval("this.inputdiv.textObj.data"+c+this.inputdiv.textObj.datapath);var e=d.split(b);var f=[];for(var g=0;g<e.length;g++){var h=e[g];if(h==this.value)continue;f.push(h);}var i=f.join(b);eval("this.inputdiv.textObj.data"+c+this.inputdiv.textObj.datapath+"="+JSON.stringify(i));this.tagdiv.parentNode.removeChild(this.tagdiv);};this.parentNode.firstChild.appendChild(b);return b;};c.onchange=function(){this.textObj.dataobj._edited=1;this.textObj.displaydiv.className.replace(/ ?changed/g,"");this.textObj.displaydiv.className+=" changed";if(this.textObj.displaydiv.bardiv){this.textObj.displaydiv.bardiv.className.replace(/ ?changed/g,"");this.textObj.displaydiv.bardiv.className+=" changed";}if(this.textObj.type=="radio"){this.custonchange();return;}if(this.textObj.type=="drop"){this.custonchange();return;}if(this.tagName.match(/span/i))c.changetext();var a=this.value;if(this.textObj.type=="taglist"){var b='.';if(this.textObj.datapath.match(/^\[/))b='';a=eval("this.textObj.data"+b+this.textObj.datapath);var d=this.value;var e=this.textObj.delim;if(e){d=d.replace(new RegExp(e+'$'),'');d=d.replace(new RegExp('^'+e),'');}if(d){this.addTag(d);this.value='';this.filteredstuff=[];if(a)a+=e;a+=d;}}this.textObj.className=this.textObj.className.replace(/ ?blank/g,"");if(!a)this.textObj.className+=" blank";var b='.';if(this.textObj.datapath.match(/^\[/))b='';eval("this.textObj.data"+b+this.textObj.datapath+"="+JSON.stringify(a));var f=this.textObj.datapath.split("|");var g=this.value.split("|");if(f.length>1)for(var h=0;h<f.length;h++){var i=f[h];var j=g[h];var b='.';if(i.match(/^\[/))b='';eval("this.textObj.data"+b+i+"="+JSON.stringify(j));}this.custonchange();return;};if(a.type=='taglist')this.applyinputsuggestions(c);if(a.suggest){this.applyinputsuggestions(c);c.stuff=a.stuff;c.filterlist();}return c;};MISHAP.PageData.applyinputsuggestions=function(a){a.stuff=[];a.filteredstuff=[];a.onkeypress=function(a){if(typeof a=='undefined')a=window.event;var b=a.which;if(typeof b=='undefined')b=a.keyCode;var c=String.fromCharCode(b);this.lastkey=c;if(this.textObj.delim){if(this.lastkey==this.textObj.delim)this.onchange();if(b==13)this.onchange();}};a.onkeyup=function(a){if(this.textObj.delim)this.value=this.value.replace(this.textObj.delim,'');if(typeof a=='undefined')a=window.event;var b=a.which;if(typeof b=='undefined')b=a.keyCode;if(b==37)return true;if(b==39)return true;if(b==38)if(this.fidx)this.fidx--;else this.fidx=this.filteredstuff.length-1;else if(b==40)if(this.fidx<this.filteredstuff.length-1)this.fidx++;else this.fidx=0;else{this.filterlist();this.fidx=0;if(!this.filteredstuff.length)return true;}if(b==46)return true;if(b==8)return true;this.setvalfromfilteredstuff();};a.setvalfromfilteredstuff=function(){if(!this.filteredstuff.length)return true;if(this.fidx>this.filteredstuff.length-1)return true;var a=this.value;var b=this.filteredstuff[this.fidx];var c=b.matchar;var d=b.val;var e=this.selectionStart;this.value=d;this.selectionStart=e;this.selectionEnd=d.length;};a.filterlist=function(){var a=this.value;var b=this.stuff;var c=a.length;var d=[];for(var e=0;e<b.length;e++){var f=b[e];var g=f.search(new RegExp("^"+a,"ig"));if(g==-1)continue;var h={'val':f,'matchar':g};d.push(h);}this.filteredstuff=d;return d;};};MISHAP.PageData.getResizeButtons=function(a){var b=document.createElement('div');var c=document.createElement('div');var d=document.createElement('div');c.style.cssFloat='left';d.style.cssFloat='right';c.className='clickable';d.className='clickable';b.appendChild(c);b.appendChild(d);a.parentNode.appendChild(b);c.appendChild(document.createTextNode('smaller'));d.appendChild(document.createTextNode('larger'));c.inputit=a;d.inputit=a;c.onclick=function(){this.inputit.rows=this.inputit.rows-5;};d.onclick=function(){this.inputit.rows=this.inputit.rows+5;};return b;};MISHAP.PageData.onPageDataSave=function(a){if(!a){MISHAP.PageData.alertit("Error!\nNothing returned");return false;}if(a.stat=="ok"){MISHAP.PageData.alertit("Success!");return true;}else if(a.err){MISHAP.PageData.alertit("Error!\n"+a.err.msg);return false;}MISHAP.PageData.alertit("Unknown Error!");return false;};MISHAP.PageData.alertit=function(a){if(this.alertbox){MISHAP.PageData.clearElements(this.alertbox);this.alertbox.appendChild(document.createTextNode(a));MISHAP.PageData.alerttimeout=setTimeout('MISHAP.PageData.clearalertbox()',MISHAP.PageData.statusdelay*1000);}};MISHAP.PageData.clearalertbox=function(){if(this.alertbox)MISHAP.PageData.clearElements(this.alertbox);};MISHAP.PageData.verifyDatapath=function(a,b){var c=b.split(/\./);var d=a;a=a.data;for(var e=0;e<c.length;e++){var f=c[e];if(!f)continue;var g='.';if(f.match(/^\[/))g='';if(!eval('dataobj'+g+f))eval('dataobj'+g+f+' = (dIdx == datapatharr.length - 1) ? "" : {}');a=eval('dataobj'+g+f);}};MISHAP.PageData.createEditTable=function(a,b){var c=document.createElement("table");c.className='data';var d=document.createElement("tbody");c.appendChild(d);for(var e=0;e<b.length;e++){var f=d.insertRow(-1);var g=[];var h=b[e];if(MISHAP.isArray(h))g=h;else g.push(h);for(var i=0;i<g.length;i++){var j=g[i];MISHAP.PageData.createCellPair(f,a,j);}}return c;};MISHAP.PageData.normalizeinputdata=function(a){if(typeof a.Default=='undefined')a.Default='';if(typeof a.Required=='undefined')a.Required=false;if(typeof a.Type=='undefined')a.Type='text';if(typeof a.Options=='undefined')a.Options='';if(typeof a.Delim=='undefined')a.Delim='';if(typeof a.Suggest=='undefined')a.Suggest='';if(typeof a.Suggestions=='undefined')a.Suggestions=[];if(typeof a.Rows=='undefined')a.Rows='1';if(typeof a.Size=='undefined')a.Size='50';if(typeof a.Width=='undefined')a.Width='';if(typeof a.OnChange=='undefined')a.OnChange=function(){};if(typeof a.OnFileUpload=='undefined')a.OnFileUpload=function(){};if(typeof a.InputWidth=='undefined')a.InputWidth='';if(typeof a.Label=='undefined')a.Label={'text':'','placement':'left'};if(typeof a.Context=='undefined')a.Context={'text':'','placement':'','color':'black'};if(typeof a.Title=='undefined')a.Title='';if(typeof a.ColSpan=='undefined')a.ColSpan=1;if(typeof a.UploadPage=='undefined')a.UploadPage='';if(typeof a.Multi=='undefined')a.Multi=0;if(typeof a.Delay=='undefined')a.Delay=0;var b=a.Label;if(MISHAP.isString(b))a.Label={'text':b,'placement':'left'};if(!a.Label.placement)a.Label.placement='left';return a;};MISHAP.PageData.createCellPair=function(a,b,c){var d=MISHAP.PageData.normalizeinputdata(c);var e=d.Path;MISHAP.PageData.verifyDatapath(b,e);var f=document.createElement('div');f.style.marginLeft='3px';var g=document.createElement('div');var h=a.insertCell(-1);var i=h;if(d.Label.placement=='left')i=a.insertCell(-1);h.appendChild(f);i.appendChild(g);i.colSpan=d.ColSpan;f.className='label';f.appendChild(document.createTextNode(d.Label.text));g.className='text';var j=document.createElement("EDIT");if(typeof (j.args)=='undefined')j.args=d;j.inputdata=d;j.id=e.replace(/\./g,"")+"edit";j.options=d.Options;j.stuff=d.Suggestions;j.suggest=d.Suggest;j.delim=d.Delim;j.type=d.Type;j.required=d.Required;j.rows=d.Rows;j.size=d.Size;j.width=d.Width;j.inputwidth=d.InputWidth;j.className="text";j.datapath=e;j.uploadpage=d.UploadPage;j.multi=d.Multi;j.delay=d.Delay;j.value="";if(e){var k='.';if(e.match(/^\[/))k='';if(!eval("dataobj.data"+k+e))eval("dataobj.data"+k+e+" = \""+d.Default+"\";");j.value=eval("dataobj.data"+k+e+"");j.value=j.value.toString().replace(/</g,"&lt;").replace(/</g,"&lt;").replace(/\n/g,"<BR>");}g.appendChild(j);};MISHAP.PageData.createEditTableHoriz=function(a,b,c){var d=document.createElement("table");var e=document.createElement("thead");var f=document.createElement("tbody");d.appendChild(e);d.appendChild(f);var g=e.insertRow(-1);g.className="header";g.insertCell(-1);for(var h=0;h<c.length;h++){var i=c[h].Label;var j=g.insertCell(-1);j.appendChild(document.createTextNode(i));}var k='.';if(b.match(/^\[/))k='';var l=eval("dataobj.data"+k+b);for(var m=0;m<l.length;m++){var n=f.insertRow(-1);var o=n.insertCell(-1);o.className="delete";for(var p=0;p<c.length;p++){var q=b+"["+m+"]."+c[p].Path;;MISHAP.PageData.verifyDatapath(a,q);var r=c[p].Default||"";var s=c[p].Type||"text";var t=c[p].Required||false;var u=c[p].Rows||"1";var v=c[p].Size||"50";var w=c[p].Width||"";var x=c[p].InputWidth||"";var y=c[p].Args||"";var z=c[p].Options||"";var A=c[p].Delim||"";var B=c[p].Suggest||"";var C=c[p].Suggestions||[];var D=c[p].UploadPage||"";var E=c[p].Delay||0;var F=c[p].Multi||0;var G=n.insertCell(-1);G.className='text';var H=document.createElement("EDIT");var I=MISHAP.PageData.normalizeinputdata(c[p]);H.inputdata=I;H.type=s;H.required=t;H.className="text";H.datapath=q;H.rows=u;H.size=v;H.width=w;H.inputwidth=x;H.args=y;H.options=z;H.suggest=B;H.delim=A;H.stuff=C;H.uploadpage=D;H.delay=E;H.multi=F;H.id=q.replace(/[\.\[\]]/g,"")+"edit";H.value="";if(q){H.value=eval("dataobj.data"+k+q+"");H.value=H.value.toString().replace(/</g,"&lt;").replace(/</g,"&lt;").replace(/\n/g,"<BR>");}var k='.';if(q.match(/^\[/))k='';if(!eval("dataobj.data"+k+q))eval("dataobj.data"+k+q+" = \""+r+"\";");H.appendChild(document.createTextNode(eval("dataobj.data"+k+q)));G.appendChild(H);}var J=document.createElement("IMG");J.src=this.geticonpath()+"/failed-sm.gif";J.className="clickable";J.dataobj=a;J.table=d;J.row=n;J.dataarr=l;J.onclick=function(){var a=this.row.rowIndex;this.dataarr.splice(a-1,1);this.table.deleteRow(a);};o.appendChild(J);}return d;};MISHAP.PageData.addButtonToBar=function(a,b){if(!a)return 0;var c=a.bardiv||a.getElementsByTagName('bardiv')[0];if(!c)return 0;var d=c.firstChild;if(!d)return 0;var e=d.appendChild(document.createElement('div'));e.className="clickable";e.className+=" barcell";if(b.link){var f=document.createElement('a');f.href=b.link;e.appendChild(f);e=f;}if(b.img){var g=document.createElement('img');g.height=16;g.width=16;g.border=0;g.src=b.img.src;g.alt=b.img.alt;e.appendChild(g);}e.savePageData=MISHAP.PageData.savePageData;e.targdiv=a;e.bardiv=c;if(b.description)e.title=b.description;if(b.text){var h=document.createElement('span');h.appendChild(document.createTextNode(b.text));e.appendChild(h);}e.onclick=b.onclick;return e;};MISHAP.PageData.clearElements=function(a){var b=a.childNodes.length;for(var c=0;c<b;c++)a.removeChild(a.firstChild);};MISHAP.PageData.fixCase=function(a){if(!a)return '';if(a!=a.toLowerCase())if(a!=a.toUpperCase())return a;a=a.toLowerCase().replace(/([-\.']) */g,'$1 ');var b=/\b([a-z'-\.]+)\b/ig;a=a.replace(b,function(a){return a.charAt(0).toUpperCase()+a.substring(1);});return a.replace(/^ *|(\-|') *| *$/g,'$1');};MISHAP.PageData.fixPhone=function(a){if(!a)return '';if(a.match(/^\d\d\d-\d\d\d-\d\d\d\d$/))return a;a=a.replace(/\)\s*/,'-');a=a.replace(/[\(\s]/g,'');a=a.replace(/[\.\s]/g,'-');if(a.match(/^\d+$/)){phonep=a.substr(0,3);phonee=a.substr(3,3);phones=a.substr(6,4);a=phonep+'-'+phonee+'-'+phones;}return a;};if(typeof MISHAP=='undefined')MISHAP={};if(typeof (MISHAP.PageData)=='undefined')MISHAP.PageData={};MISHAP.PageData.DataObj=function(a){this.toString=function(){return "[object MISHAP.PageData.DataObj]";};this.data={uid:"",page:"",style:"textblock",divid:"",title:"",category:"",align:"center",html:""};if(a)this.data=a;this.style="";this.defaultstyle="textblock";this.saveurl="/cgi-bin/savepagedata";this.getsavevariablestr=function(){return "";};this.tagName="DIV";this.className="";this.toHTML=function(a){this.style="view";if(!a)a=document.getElementById(this.data.divid);a.className=a.className.replace(/ ?edit| ?view/g,"");a.className+=" view";var b=a.getElementsByTagName("content")[0];if(!this.data.style)this.data.style="textblock";if(this.data.style=="textblock")this.toHTMLtextblock(b);else if(this.data.style=="link")this.toHTMLlink(b);},this.toHTMLtextblock=function(a){var b=MISHAP.PageData.prepTarg({dataobj:this,targdiv:a,style:"view"});var c=document.createElement("label");c.className="label";var d=document.createElement("div");d.style.textAlign=this.data.align||"center";d.className="html";b.appendChild(c);b.appendChild(d);var e=this.data.title||"";var f=this.data.html||"";f=f.replace(/<script/g,"&lt;script");f=f.replace(/\n/g,"<br>").replace(/<br><li>/g,"<li>");c.appendChild(document.createTextNode(e));d.innerHTML=f;};this.toHTMLlink=function(a){a.innerHTML="";var b=this.data.link;var c=this.data.text;var d=this.data.description;var e=document.createElement("div");e.style.textAlign=this.data.align||"center";var f=document.createElement("a");f.className="label";f.innerHTML=c;f.href=b;f.target="_blank";var g=document.createElement("div");g.style.textAlign=this.data.align||"center";g.className="html";g.innerHTML=d;e.appendChild(f);a.appendChild(e);a.appendChild(g);};this.toEDIT=function(a){var b=MISHAP.PageData.prepTarg({dataobj:this,targdiv:a,style:"edit"});if(!this.data.style)this.data.style="textblock";if(this.data.style=="textblock")this.toEDITtextblock(b);else if(this.data.style=="text")this.toEDITtextblock(b);else if(this.data.style=="link")this.toEDITlink(b);return;};this.toEDITtextblock=function(a){a.innerHTML="";var b=[{Default:"textblock",Path:"style",Type:"radio",Options:"textblock,link",Label:"Style"},{Default:"",Path:"category",Label:"Category"},{Default:"",Path:"title",Label:"Title"},{Default:"center",Path:"align",Type:"radio",Options:"left,center,right",Label:"Align"},{Default:"",Path:"html",Label:"Text",Rows:"7"}];a.dataobj=this;a.appendChild(MISHAP.PageData.createEditTable(this,b));MISHAP.PageData.applyEditTags(a);};this.toEDITlink=function(a){a.innerHTML="";var b=[{Default:"text",Path:"style",Type:"radio",Options:"textblock,link",Label:"Style"},{Default:"center",Path:"align",Type:"radio",Options:"left,center,right",Label:"Align"},{Default:"",Path:"category",Label:"Category"},{Default:"",Path:"text",Label:"Site Name"},{Default:"",Path:"link",Label:"URL"},{Default:"",Path:"description",Label:"Description"}];a.dataobj=this;a.appendChild(MISHAP.PageData.createEditTable(this,b));MISHAP.PageData.applyEditTags(a);};return this;};if(typeof MISHAP=='undefined')MISHAP={};if(typeof (MISHAP.PageData)=='undefined')MISHAP.PageData={};MISHAP.PageData.DataEntry=function(a){this.toString=function(){return "[object MISHAP.PageData.DataEntry]";};this.data={uid:""};if(a)this.data=a;this.style='table';this.saveurl="";this.getsavevariablestr=function(){return "";};this.tagName="div";this.className="dataentry";this.toHTML=function(a){var b=MISHAP.PageData.prepTarg({dataobj:this,targdiv:a,style:"view"});var c=document.createElement("div");c.className='info';c.id='infodiv'+this.data.uid;c.contentdiv=b;c.bardiv=this.targdiv.bardiv;b.appendChild(c);this.toHTMLinfo(c);};this.toHTMLinfo=function(a){MISHAP.PageData.clearElements(a);var b=0;a.dataobj=this;var c=this._getdatapatharr();for(var d=0;d<c.length;d++){darr=c[d];darr.Type="None";}a.appendChild(MISHAP.PageData.createEditTable(this,c));MISHAP.PageData.applyEditTags(a);};this.toEDIT=function(a){var b=MISHAP.PageData.prepTarg({dataobj:this,targdiv:a,style:"edit"});var c=document.createElement("div");c.className='info';c.id='infodiv'+this.data.uid;c.contentdiv=b;c.bardiv=this.targdiv.bardiv;b.appendChild(c);this.toEDITinfo(c);};this.toEDITinfo=function(a){MISHAP.PageData.clearElements(a);var b=0;a.dataobj=this;var c=this._getdatapatharr();a.appendChild(MISHAP.PageData.createEditTable(this,c));MISHAP.PageData.applyEditTags(a);};this._getdatapatharr=function(a,b){if(b>10){console.log('max path depth reached');return [];}var c=[];var d=this.data;var e='';if(a){e=a.replace(/\["/g,'.').replace(/"\]/g,'').replace(/^\./,'');if(e=='uid')return [];if(e.match('^_'))return [];d=eval("this.data"+a);}if(MISHAP.isFunction(d))return [];if(MISHAP.isArray(d)){for(var f=0;f<d.length;f++){var g=a+'['+f+']';var h=this._getdatapatharr(g,b+1);var i=c.concat(h);c=i;}return c;}else if(MISHAP.isObject(d)){for(var j in d){var k='["'+j+'"]';var l=k;if(a)l=a+k;var h=this._getdatapatharr(l,b+1);var i=c.concat(h);c=i;}return c;}else{var m={'Path':a,'Type':'text','Label':e};c.push(m);return c;}return c;};return this;};if(typeof MISHAP=="undefined")var MISHAP={};if(typeof MISHAP.PageData=="undefined")MISHAP.PageData={};MISHAP.PageData.ObjList=function(a){this.toString=function(){return "[object MISHAP.PageData.ObjList]";};this.data={uid:"",page:"",divid:"",title:"",style:"",dataobj:"",saveurl:"",category:"",tablabel:"",html:""};this.init=function b(){this.setDiv(a);this.initProperties();};this.initProperties=function(){this.DataObj=MISHAP.PageData.DataObj;this.Slides=[];this.dataObjects=[];this.custombutts=[];this.allowedObjects=[];this.style="html";this.action="view";this.position="top";this.title="";this.defaultlabel="Other";this.saveurl="";this.objDisplayFcn="toHTML";this.getsavevariablestr=function(){return "";};this.currTab;this.targdiv;this.currSelect;this.sortfunction=function(a,b){if(parseInt(a.data._listidx)<parseInt(b.data._listidx))return -1;if(parseInt(a.data._listidx)>parseInt(b.data._listidx))return 1;return 0;};};this.gotListData=function(b){if(!b){MISHAP.PageData.alertit("no data returned");return false;}if(b.stat!='ok'){var c="Error!";if(b.err)if(b.err.msg)c+="\n"+b.err.msg;MISHAP.PageData.alertit("Error!\n"+b.err.msg);return false;}var d=[];if(b.data)d=b.data;var e=this.targdiv;if(!e){MISHAP.PageData.alertit("Got data, but can't figure out where to put it");return false;}var f=e.dataobj;f.targdiv=e;if(f!="[object MISHAP.PageData.ObjList]"){MISHAP.PageData.alertit("No datatype selected for this data.");return false;}for(var g=0;g<d.length;g++)f.addObj(d[g]);f.toHTML();MISHAP.PageData.ongotListData(d,a);};this.setDiv=function(a){var b=a;if(typeof a=='string')b=document.getElementById(a);if(b){b.dataobj=this;b.className+=" List";}this.targdiv=b;return this;};this.setCategoryPath=function(a){this.data.category=a;return this;};this.getCategoryPath=function(){return this.data.category;};this.setTablabelPath=function(a){this.data.tablabel=a;return this;};this.getTablabelPath=function(){return this.data.tablabel;};this.addObj=function(a){var b=new this.DataObj(a);if(this.saveurl)b.saveurl=this.saveurl;if(b.data._listidx==undefined)b.data._listidx=this.dataObjects.length;this.dataObjects.unshift(b);if(this.style=="tabbed"){var c=this.getTablabelPath();if(!eval("dataobj.data."+c)){var d=this.getSlideSelected();if(d)eval("dataobj.data."+c+" = \""+d.label+"\"");}}return b;};this.toHTML=function(){if(this.style=="html")return this.toHTMLstandard();else if(this.style=="index")return this.toHTMLindex();else if(this.style=="categorized")return this.toHTMLcategorized();else if(this.style=="tabbed")return this.toHTMLtabbed();};this.displayTabByLabel=function(a){if(this.style!="tabbed")return;var b=this.TabbedDisplay.Slides;for(var c=0;c<b.length;c++)if(b[c].label==a){b[c].tab.onclick();break;}};this.collectTablabels=function(){var a=[];var b=this.getTablabelPath();if(!b)return a;for(var c=0;c<this.dataObjects.length;c++){var d=this.dataObjects[c];var e=this.convertTabLabel(eval("lObj.data."+b))||this.defaultlabel;var f=d.data.Name;var g=1;for(var h=0;h<a.length;h++)if(a[h]==e){g=0;break;}if(!g)continue;a.push(e);}return a;};this.collectCategories=function(){var a=[];var b=this.getCategoryPath();if(!b)return a;for(var c=0;c<this.dataObjects.length;c++){var d=this.dataObjects[c];var e=eval("lObj.data."+b)||"Unspecified";var f=d.data.Name;var g=1;for(var h=0;h<a.length;h++)if(a[h]==e){g=0;break;}if(!g)continue;a.push(e);}return a;};this.convertTabLabel=function(a){return a;};this.toHTMLtabbed=function(){if(!this.targdiv)return 0;var a=this.getTablabelPath();if(!a)return retArr;this.dataObjects=this.dataObjects.sort(this.sortfunction);var b=this.targdiv;var c=b.getElementsByTagName("content")[0]||b;MISHAP.PageData.clearElements(c);var d=document.createElement("label");d.className="title";d.appendChild(document.createTextNode(this.title));c.appendChild(d);var e=this.collectTablabels().sort();var f=new MISHAP.TabbedDisplay();f.targdiv=c;f.position=this.position;f.init();this.TabbedDisplay=f;for(var g=0;g<e.length;g++){var h=e[g];var i=document.createElement("div");i.id=h+"slide";var j=f.addSlide({label:h,slide:i});}if(this.TabbedDisplay.Slides[0])this.TabbedDisplay.Slides[0].slide.activate();for(var k=0;k<this.dataObjects.length;k++){var l=this.dataObjects[k];l.listObj=this;if(!l.saveurl)l.saveurl=this.saveurl||MISHAP.PageData.saveurl||"";var m=l.tagName||"div";var n=l.className||"";var o=document.createElement(l.tagName);o.style.display="block";o.className=" ListItem "+n;var h=this.convertTabLabel(eval("lObj.data."+a))||this.defaultlabel;if(!h)continue;var p=this.TabbedDisplay.getSlideByLabel(h);if(!p)continue;var q=p.slide;if(p.num)p.num++;else p.num=1;var r=p.num;var s=(r/2==parseInt(r/2));if(s)o.className+=" shade";q.appendChild(o);o.dataobj=l;MISHAP.PageData.initDiv(o);var b=o;var t=b.getElementsByTagName("bardiv")[0];t.className=b.className.replace(/ ?view| ?edit/g,"");t.className+=" view";var u=b.getElementsByTagName("content")[0];u.className=b.className.replace(/ ?view| ?edit/g,"");u.className+=" view";l.targdiv=o;if(this.objDisplayFcn)l[this.objDisplayFcn](o);else if(this.action=="view")l.toHTML(o);else if(this.action=="edit")l.toEDIT(o);}};this.getSlideByLabel=function(a){for(var b=0;b<this.Slides.length;b++)if(this.Slides[b].label==a)return this.Slides[b];return 0;};this.getSlideSelected=function(){if(!this.TabbedDisplay)return 0;var a=this.TabbedDisplay.Slides;for(var b=0;b<a.length;b++)if(a[b].tab.className.match(/selected/))return a[b];return 0;};this.categorydivs=[];this.createcategorydiv=function(a){var b=document.createElement("div");b.className="category";var c=document.createElement('label');c.className="label category";c.appendChild(document.createTextNode(a));var d=document.createElement("div");d.className="PageData List";b.appendChild(c);b.appendChild(d);this.categorydivs[a]=b;return b;};this.toHTMLcategorized=function(){if(!this.targdiv)return 0;var a=MISHAP.PageData.prepTarg({dataobj:this,targdiv:this.targdiv,style:"view"});var b=this.getCategoryPath();if(!b)return retArr;var c=false;this.dataObjects=this.dataObjects.sort(this.sortfunction);var d=document.createElement("label");d.className="title";d.appendChild(document.createTextNode(this.title));a.appendChild(d);var e=this.collectCategories().sort();for(var f=0;f<e.length;f++){var g=e[f]||"Unspecified";var h=this.createcategorydiv(g);h.id=a.id+"cat"+g;a.appendChild(h);this.catdivs.push(h);}for(var i=0;i<this.dataObjects.length;i++){var j=this.dataObjects[i];if(!j.saveurl)j.saveurl=this.saveurl||MISHAP.PageData.saveurl||"";var k=j.tagName||"div";var l=j.className||"";var m=document.createElement(j.tagName);m.className=" ListItem "+l;if(c=!c)m.className+=" shade";var g=eval("lObj.data."+b)||"Unspecified";if(!g)continue;var h=this.categorydivs[g];if(!h)continue;h.appendChild(m);m.dataobj=j;MISHAP.PageData.initDiv(m);var n=MISHAP.PageData.prepTarg({dataobj:j,targdiv:m,style:"view"});j.toHTML();}};this.toHTMLstandard=function(){if(!this.targdiv)return 0;var a=MISHAP.PageData.prepTarg({dataobj:this,targdiv:this.targdiv,style:"view"});var b=false;this.dataObjects=this.dataObjects.sort(this.sortfunction);var c=document.createElement("label");c.className="title";c.appendChild(document.createTextNode(this.title));a.appendChild(c);for(var d=0;d<this.dataObjects.length;d++){var e=this.dataObjects[d];b=(d/2==parseInt(d/2));var f=this.createObjDiv(e,b);a.appendChild(f);}};this.createObjDiv=function(a,b){if(!a.saveurl)a.saveurl=this.saveurl||MISHAP.PageData.saveurl||"";var c=a.tagName||"div";if(c=="undefined")c="div";var d=a.className||"";var e=document.createElement(a.tagName);e.className="ListItem "+d;e.id=a.data.divid||this.targdiv.id||"";e.id+="idx"+a.data._listidx;if(b)e.className+=" shade";e.dataobj=a;MISHAP.PageData.initDiv(e);a.displayDiv=e;a.listObj=this;a[this.objDisplayFcn](e);for(var f=0;f<this.custombutts.length;f++){var g=this.custombutts[f];var h=g.buttobj;var i=MISHAP.PageData.addButtonToBar(e,h);var j=g.saveurl;if(j)i.saveurl=j;}return e;};this.addButtonToObjBar=function(a){this.custombutts.push(a);return this;};this.toHTMLindex=function(){if(!this.targdiv)return 0;var a=MISHAP.PageData.prepTarg({dataobj:this,targdiv:this.targdiv,style:"view"});if(!this.dataObjects.length)return;this.dataObjects=this.dataObjects.sort(this.sortfunction);var b=document.createElement("label");b.className="title";b.innerHTML=this.title;a.appendChild(b);var c=document.createElement("table");c.className="list";a.appendChild(c);var d=document.createElement("thead");var e=document.createElement("tbody");c.appendChild(d);c.appendChild(e);var f=d.insertRow(-1);var g=new this.DataObj().getIndexHeaders();for(var h=0;h<g.length;h++){var i=f.insertCell(-1);i.innerHTML=g[h];}var j=false;var k=this.filter(this.dataObjects);for(var l=0;l<k.length;l++){var m=e.insertRow(-1);var n=k[l];n.indexRow=m;n.targdiv=this.objdisplayDiv;if(this.objdisplayDiv.dataobj)if(this.objdisplayDiv.dataobj==n){m.className='selected';this.currSelect=m;}j=(l/2==parseInt(l/2));this.addObjIndex(n,j);}};this.filter=function(a){return a;};this.addObjIndex=function(a,b){if(!a.saveurl)a.saveurl=this.saveurl||MISHAP.PageData.saveurl||"";var c=a.getIndexValues();var d=c.fields;var e=a.indexRow;if(c.className)e.className=c.className;for(var f=0;f<d.length;f++){var g=d[f];var h=e.insertCell(-1);h.listobj=this;h.dataobj=a;h.row=e;h.innerHTML=g.value||g["default"];if(g.title)h.title=g.title;if(g.onclick){h.valonclick=g.onclick;h.onclick=function(){this.listobj.changeSelected(this.row);this.valonclick();};h.className="clickable";}if(g.className)h.className+=" "+g.className;}if(b)e.className+=" shade";return e;};this.changeSelected=function(a){if(this.currSelect)this.currSelect.className=this.currSelect.className.replace(/\s?selected/g,'');a.className+=" selected";this.currSelect=a;};this.toHTMLtextblock=function(a){a.innerHTML="";var b=document.createElement("label");b.className="title";var c=document.createElement("div");c.className="html";a.appendChild(b);a.appendChild(c);var d=this.data.title||"";b.appendChild(document.createTextNode(d));c.innerHTML=this.data.html||"";};this.toEDIT=function(){return;};this.init();return this;};if(typeof MISHAP=="undefined")MISHAP={};MISHAP.User=function(a){this.toString=function(){return "[object MISHAP.User]";};this._dataversion="2.01";this.data={uid:"",_version:"0",_class:"",Logins:[{id:""}],'Status':'',Email:"",Referral:"",Name:{Title:"",First:"",Last:"",Suffix:""},Phone:"",MailingAddress:{Address1:"",Address2:"",City:"",State:"",Zip:""}};this.providerlinks={'google':'https://www.google.com/accounts/IssuedAuthSubTokens','facebook':'http://www.facebook.com/editapps.php'};if(a)this.data=a;this.saveurl=MISHAP.protocol+"//"+MISHAP.site+"/user/save";this.callback="MISHAP.onUserSave";this.getsavevariablestr=function(){var a="";a+="userdata="+escape(JSON.stringify(OIDAUTH.authdata));a+="&c="+this.callback;return a;};this.tagName="MISHAPUser";this.className="";this.getFullName=function(){var a=this.data.Name.Title;a+=" "+this.data.Name.First;a+=" "+this.data.Name.Last;if(this.data.Name.Suffix)a+=", "+this.data.Name.Suffix;return a;};this.updateDataFields=function(){if(this._dataversion==this.data._version)return;if(this.data.uid==undefined)this.data.uid="";if(this.data.Status==undefined)this.data.Status="current";if(this.data.Email==undefined)this.data.Email="";if(this.data.Phone==undefined)this.data.Phone="";if(this.data.Referral==undefined)this.data.Referral="";if(this.data._class==undefined)this.data._class="";if(this.data.Logins==undefined)this.data.Logins=[];for(var a=0;a<this.data.Logins.length;a++)if(this.data.Logins[a].id==undefined)this.data.Logins[a].id="";if(this.data.Name==undefined)this.data.Name={};if(this.data.Name.Title==undefined)this.data.Name.Title="";if(this.data.Name.First==undefined)this.data.Name.First="";if(this.data.Name.Last==undefined)this.data.Name.Last="";if(this.data.Name.Suffix==undefined)this.data.Name.Suffix="";if(this.data.MailingAddress==undefined)this.data.MailingAddress={};if(this.data.MailingAddress.Address1==undefined)this.data.MailingAddress.Address1="";if(this.data.MailingAddress.Address2==undefined)this.data.MailingAddress.Address2="";if(this.data.MailingAddress.City==undefined)this.data.MailingAddress.City="";if(this.data.MailingAddress.State==undefined)this.data.MailingAddress.State="";if(this.data.MailingAddress.Zip==undefined)this.data.MailingAddress.Zip="";this.data._version=this._dataversion;return this;};this.normalizeData=function(){this.data.Phone=MISHAP.PageData.fixPhone(this.data.Phone);this.data.Name.First=MISHAP.PageData.fixCase(this.data.Name.First);this.data.Name.Last=MISHAP.PageData.fixCase(this.data.Name.Last);this.data.MailingAddress.Address1=MISHAP.PageData.fixCase(this.data.MailingAddress.Address1);this.data.MailingAddress.City=MISHAP.PageData.fixCase(this.data.MailingAddress.City);if(this.data.Name.Suffix.match(/ms|mrs|mr/i))this.data.Name.Suffix='';};this.toINDEX=function(a){var b=MISHAP.PageData.prepTarg({dataobj:this,targdiv:a,style:"view"});if(!b)return 0;this.displayDiv=b;var c=document.createElement("table");var d=c.insertRow(-1);var e=d.insertCell(-1);var f=d.insertCell(-1);e.className="label";e.appendChild(document.createTextNode(this.data.uid));f.appendChild(document.createTextNode(this.data.type));b.appendChild(c);return this;};this.toHTML=function(a){var b=MISHAP.PageData.prepTarg({dataobj:this,targdiv:a,style:"view"});if(!b)return 0;this.displayDiv=b;var c=document.createElement("DIV");var d=document.createElement("DIV");b.appendChild(c);this.toHTMLinfo(c);};this.toHTMLinfo=function(a){var b=document.createElement("div");b.className="name";var c=document.createElement("div");var d=document.createElement("div");var e=document.createElement("div");var f=document.createElement("div");c.className="info login";d.className="info";e.className="info";f.className="info";var g=document.createElement("div");g.className="info address";var h=document.createElement("div");var i=document.createElement("div");var j=document.createElement("div");b.appendChild(document.createTextNode(this.getFullName()));d.appendChild(document.createTextNode(this.data.Referral));c.appendChild(document.createTextNode(''));if(this.data.Logins[0])if(!this.data.Logins[0].id)c.appendChild(document.createTextNode('NO LOGIN'));var k=document.createTextNode(this.data.Email);if(this.data.Email.match("@")){var l=document.createElement('a');l.href='mailto:'+this.data.Email;l.appendChild(k);e.appendChild(l);}else e.appendChild(k);f.appendChild(document.createTextNode(this.data.Phone));h.appendChild(document.createTextNode(this.data.MailingAddress.Address1));i.appendChild(document.createTextNode(this.data.MailingAddress.Address2));j.appendChild(document.createTextNode(this.data.MailingAddress.City+", "+this.data.MailingAddress.State+" "+this.data.MailingAddress.Zip));g.appendChild(h);g.appendChild(i);g.appendChild(j);a.appendChild(b);a.appendChild(e);a.appendChild(f);a.appendChild(g);a.appendChild(c);a.appendChild(d);};this.toEDIT=function(a){var b=MISHAP.PageData.prepTarg({dataobj:this,targdiv:a,style:"edit"});if(!b)return 0;this.displayDiv=b;var c=document.createElement("DIV");var d=document.createElement("DIV");b.appendChild(c);b.appendChild(d);this.toEDITinfo(c);};this.toEDITinfo=function(a){var b=[{Path:"Name.Title",Label:"Title",Type:"radio",Options:"Mr.,Mrs.,Miss,Ms."},{Path:"Name.First",Label:"First Name"},{Path:"Name.Last",Label:"Last Name"},{Path:"Name.Suffix",Label:"Suffix"},{Path:"Email",Label:"Email Address"},{Path:"Phone",Label:"Phone"},{Path:"MailingAddress.Address1",Label:"Address1"},{Path:"MailingAddress.Address2",Label:"Address2"},{Path:"MailingAddress.City",Label:"City"},{Path:"MailingAddress.State",Label:"State"},{Path:"MailingAddress.Zip",Label:"Zip"},{Path:"Logins[0].id",Type:"none",Label:"Login"}];for(var c=1;c<this.data.Logins.length;c++){var d={Path:"Logins["+c+"].id",Type:"none",Label:"alt Login "+c};b.push(d);}if(!this.data.Referral){var d={Path:"Referral",Label:"How did you hear about us?",Type:"text"};b.push(d);}a.dataobj=this;var e=MISHAP.PageData.createEditTable(this,b);a.appendChild(e);MISHAP.PageData.applyEditTags(a);};this.toEDITinfologins=function(a){var b=[];if(typeof (this.data.Logins)==undefined)this.data.Logins=[{"id":""}];for(var c=0;c<this.data.Logins.length;c++){var d={};d.onclick=function(){alert('wtf');},d.Default="";d.Path="Logins["+c+"].id";d.Rows="1";b.push(d);}var e={edittable:a,dataobj:this,Label:"Logins",datapatharr:b,refresh:function(a){this.dataobj.data.Logins.push({"id":""});this.dataobj.toEDITinfologins(a);}};var f=MISHAP.PageData.addArrayToEditTable(e);f.dataobj=this;MISHAP.PageData.applyEditTags(f);};this.updateDataFields();this.normalizeData();return this;};if(typeof MISHAP=="undefined")MISHAP={};MISHAP.Menu=function(a){this.toString=function(){return "[object MISHAP.Menu]";};this.Version="1.0";this.jsbin="/bin/getMenu.php";this.saveurl="/bin/savemenu.php";this.items=[];this.style="list";this.divid=a;this.stylerules=[];this.div="";this.privs=['owner','admin','employee','guest','customer','all'];this.List=[];this.init=function(){if(typeof (MISHAP.Style)=='undefined')return;this.Style=new MISHAP.Style(this.divid);this.Style.addStyleRule("a:hover",["color: red"]);this.Style.addStyleRule("a",["color: blue"]);this.Style.addStyleRule("",["list-style-position:inside","position: relative","z-index: 500"]);this.Style.addStyleRule("*",["list-style-position:inside","padding-left: 3px","padding-right: 3px"]);this.Style.addStyleRule("ul.horiz",["display:block","margin:0","text-align:center"]);this.Style.addStyleRule("ul.horiz *",["display:inline"]);this.Style.addStyleRule("ul.horiz li",["background: url("+MISHAP.PageData.geticonpath()+"/box.blue.gif) no-repeat 0 0.3em","padding-left: 15px"]);this.Style.addStyleRule("ul.horiz li ul",["padding: 0px","background-color:#FFFFFF","border:3px inset black","padding:5px","position:absolute","margin-top:1.1em","margin-left:-3.3em"]);this.Style.addStyleRule("ul.horiz li ul li",["display:block","background:none","padding-left:0px","text-align:left","list-style:none"]);this.Style.addStyleRule("ul.list li ul",["padding: 0px","background-color:#FFFFFF","border:3px inset black","padding:5px","position:absolute","margin-top:-1.1em","margin-left:3.3em"]);this.Style.addStyleRule("ul.list li ul li",["display:block","background:none","padding-left:0px","text-align:left","list-style:none"]);this.Style.applyStyle();};this.build=function(){if(!this.div)this.div=document.getElementById(this.divid);if(!this.div)return 0;var a=this.div;MISHAP.PageData.clearElements(a);var b=document.createElement("ul");b.className=this.style;a.appendChild(b);for(var c=0;c<this.List.length;c++){var d=this.List[c];var e=b;if(d.data.category){var f=this.getMenuItemByName(d.data.category);if(!f){f=new MISHAP.Menu.Item({"text":d.data.text});f.Menu=this;this.List.push(f);}if(!f.sublist){var g=document.createElement("ul");f.sublist=g;f.sublist.style.display="none";if(f.listitem){f.listitem.sublist=f.sublist;f.listitem.appendChild(f.sublist);f.listitem.onmouseover=function(){this.sublist.style.display="";};f.listitem.onmouseout=function(){this.sublist.style.display="none";};}}e=f.sublist;}var h=this.createListItem(d);d.listitem=h;e.appendChild(h);if(d.sublist){h.appendChild(d.sublist);d.listitem.sublist=d.sublist;d.listitem.onmouseover=function(){this.sublist.style.display="";};d.listitem.onmouseout=function(){this.sublist.style.display="none";};}}return a;};this.createListItem=function(a){var b=a.data.link;var c=a.data.text;var d=a.data.description||"";var e=document.createElement("li");var f=document.createElement("a");if(MISHAP.thisurl==b){f.style.color="black";f.style.fontWeight="bold";f.removeAttribute("href");}else f.href=b?b:"javascript:void(0)";f.title=d;f.appendChild(document.createTextNode(c));e.appendChild(f);return e;};this.addItem=function(a){var b=a.text;var c=a.link;if(!this.div)this.div=document.getElementById(this.divid);if(!this.div)return 0;var d=this.div;var e=document.createElement("IMG");e.src=MISHAP.PageData.geticonpath()+"/box.blue.gif";var f=document.createElement("A");if(MISHAP.thisurl==c){f.style.color="black";f.style.fontWeight="bold";}else f.href=c;f.appendChild(document.createTextNode(b));d.appendChild(f);d.appendChild(e);return f;};this.load=function(){var a=[];MISHAP.AJAX.getJSON(this.jsbin,a.join("&"),this.loaded,this);};this.loaded=function(a){if(!MISHAP.PageData.onPageDataSave(a))return false;var b=a.data;this.List=[];this.addItems(b);this.build();var c=this.divid;this.onloaded(a,c);};this.addItems=function(a){for(var b=0;b<a.length;b++){var c=new MISHAP.Menu.Item(a[b]);c.Menu=this;c.saveurl=this.saveurl;this.List.push(c);}};this.getMenuItemByName=function(a){for(var b=0;b<this.List.length;b++){var c=this.List[b];if(c.data.text==a)return c;}return 0;};this.onloaded=function(a,b){};this.collectCategories=function(a,b){};this.init();return this;};if(typeof MISHAP=="undefined")MISHAP={};if(typeof (MISHAP.Menu)=="undefined"){MISHAP.Menu=function(a){return this;};console.log('MISHAP.Menu does not exist');}MISHAP.Menu.Item=function(a){this.toString=function(){return "[object MISHAP.Menu.Item]";};this.data={uid:"",text:"",icon:"",link:"",permissions:[]};if(a)this.data=a;this.style="";this.defaultstyle="textblock";this.tagName="Menu";this.className="Menu";this.saveurl=MISHAP.Menu.saveurl;this.getsavevariablestr=function(){return "";};this.getIndexHeaders=function(){var a=["Order","Category","Menu"];return a;};this.getIndexValues=function(){var a=function(){this.dataobj.toEDIT();this.dataobj.targdiv.style.display="";};var b={onclick:function(){},fields:[{"default":"",value:this.data._listidx,onclick:a},{"default":"",value:this.data.category,onclick:a},{"default":"",value:this.data.text,onclick:a}]};return b;};this.toHTML=function(a){var b=MISHAP.PageData.prepTarg({dataobj:this,style:"view",targdiv:a});var c=document.createElement("div");var d=document.createElement("div");var e=document.createElement("div");var f=document.createElement("span");var g=document.createElement("span");var h=document.createElement("a");h.innerHTML="download";h.href=this.data.file;h.className="download";f.innerHTML=this.data.title;f.className="title";g.innerHTML="[";g.appendChild(h);g.innerHTML+="]";d.innerHTML=this.data.description;d.className="description";if(this.data.editedby){e.innerHTML="Last edited by: "+this.data.editedby;if(this.data.editedon)e.innerHTML+=" on "+this.data.editedon;}e.className="editedby";c.appendChild(f);c.appendChild(g);b.appendChild(c);b.appendChild(d);b.appendChild(e);return this;};this.toEDIT=function(a){var b=MISHAP.PageData.prepTarg({dataobj:this,tagdiv:a,style:"edit"});if(!b)return false;var c=document.createElement("DIV");c.className='info';c.id='infodiv'+this.data.uid;c.contentdiv=b;var d=document.createElement("DIV");d.className='privilege';d.id='privdiv'+this.data.uid;d.contentdiv=b;this.updateInfoEDIT(c);this.updatePermissionsEDIT(d);b.appendChild(c);b.appendChild(d);return this;};this.updateInfoEDIT=function(a){a.innerHTML="";var b=[{Path:"text",Label:"Label"},{Path:"category",Label:"Category"},{Path:"_listidx",Label:"Sort Order"},{Path:"icon",Label:"Icon"},{Rows:3,Path:"description",Label:"Description"},{Path:"link",Label:"Link"}];a.dataobj=this;var c=MISHAP.PageData.createEditTable(this,b);a.appendChild(c);MISHAP.PageData.applyEditTags(a);return c;};this.updatePermissionsEDIT=function(a){a.innerHTML="";a.dataobj=this;var b=document.createElement("addimg");var c=document.createElement("label");c.className="label";c.innerHTML="Permissions";b.src=MISHAP.PageData.geticonpath()+"/icon_addprofile_22x16.gif";b.dataobj=this;b.targdiv=a;b.className='clickable';b.onclick=function(){if(!this.dataobj.data.permissions)this.dataobj.data.permissions=[];this.dataobj.data.permissions.push({"privilege":""});this.dataobj.updatePermissionsEDIT(this.targdiv);};c.appendChild(b);a.appendChild(c);if(this.data.permissions.length){if(typeof (MISHAP.Menu.privs)=='undefined')MISHAP.Menu.privs=new MISHAP.Menu().privs;var d="permissions";var e=[{Path:"privilege",Label:"Privilege Level",Type:"radio",Options:MISHAP.Menu.privs.join(',')}];var f=MISHAP.PageData.createEditTableHoriz(this,d,e);a.appendChild(f);}MISHAP.PageData.applyEditTags(a);};return this;};Date.CultureInfo={name:"en-US",englishName:"English (United States)",nativeName:"English (United States)",dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbreviatedDayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],shortestDayNames:["Su","Mo","Tu","We","Th","Fr","Sa"],firstLetterDayNames:["S","M","T","W","T","F","S"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],abbreviatedMonthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],amDesignator:"AM",pmDesignator:"PM",firstDayOfWeek:0,twoDigitYearMax:2029,dateElementOrder:"mdy",formatPatterns:{shortDate:"M/d/yyyy",longDate:"dddd, MMMM dd, yyyy",shortTime:"h:mm tt",longTime:"h:mm:ss tt",fullDateTime:"dddd, MMMM dd, yyyy h:mm:ss tt",sortableDateTime:"yyyy-MM-ddTHH:mm:ss",universalSortableDateTime:"yyyy-MM-dd HH:mm:ssZ",rfc1123:"ddd, dd MMM yyyy HH:mm:ss GMT",monthDay:"MMMM dd",yearMonth:"MMMM, yyyy"},regexPatterns:{jan:/^jan(uary)?/i,feb:/^feb(ruary)?/i,mar:/^mar(ch)?/i,apr:/^apr(il)?/i,may:/^may/i,jun:/^jun(e)?/i,jul:/^jul(y)?/i,aug:/^aug(ust)?/i,sep:/^sep(t(ember)?)?/i,oct:/^oct(ober)?/i,nov:/^nov(ember)?/i,dec:/^dec(ember)?/i,sun:/^su(n(day)?)?/i,mon:/^mo(n(day)?)?/i,tue:/^tu(e(s(day)?)?)?/i,wed:/^we(d(nesday)?)?/i,thu:/^th(u(r(s(day)?)?)?)?/i,fri:/^fr(i(day)?)?/i,sat:/^sa(t(urday)?)?/i,future:/^next/i,past:/^last|past|prev(ious)?/i,add:/^(\+|aft(er)?|from|hence)/i,subtract:/^(\-|bef(ore)?|ago)/i,yesterday:/^yes(terday)?/i,today:/^t(od(ay)?)?/i,tomorrow:/^tom(orrow)?/i,now:/^n(ow)?/i,millisecond:/^ms|milli(second)?s?/i,second:/^sec(ond)?s?/i,minute:/^mn|min(ute)?s?/i,hour:/^h(our)?s?/i,week:/^w(eek)?s?/i,month:/^m(onth)?s?/i,day:/^d(ay)?s?/i,year:/^y(ear)?s?/i,shortMeridian:/^(a|p)/i,longMeridian:/^(a\.?m?\.?|p\.?m?\.?)/i,timezone:/^((e(s|d)t|c(s|d)t|m(s|d)t|p(s|d)t)|((gmt)?\s*(\+|\-)\s*\d\d\d\d?)|gmt|utc)/i,ordinalSuffix:/^\s*(st|nd|rd|th)/i,timeContext:/^\s*(\:|a(?!u|p)|p)/i},timezones:[{name:"UTC",offset:"-000"},{name:"GMT",offset:"-000"},{name:"EST",offset:"-0500"},{name:"EDT",offset:"-0400"},{name:"CST",offset:"-0600"},{name:"CDT",offset:"-0500"},{name:"MST",offset:"-0700"},{name:"MDT",offset:"-0600"},{name:"PST",offset:"-0800"},{name:"PDT",offset:"-0700"}]};(function(){var a=Date,b=a.prototype,c=a.CultureInfo,d=function(a,b){if(!b)b=2;return("000"+a).slice(b*-1);};b.clearTime=function(){this.setHours(0);this.setMinutes(0);this.setSeconds(0);this.setMilliseconds(0);return this;};b.setTimeToNow=function(){var a=new Date();this.setHours(a.getHours());this.setMinutes(a.getMinutes());this.setSeconds(a.getSeconds());this.setMilliseconds(a.getMilliseconds());return this;};a.today=function(){return new Date().clearTime();};a.compare=function(a,b){if(isNaN(a)||isNaN(b))throw new Error(a+" - "+b);else if(a instanceof Date&&b instanceof Date)return(a<b)?-1:(a>b)?1:0;else throw new TypeError(a+" - "+b);};a.equals=function(a,b){return(a.compareTo(b)===0);};a.getDayNumberFromName=function(a){var b=c.dayNames,d=c.abbreviatedDayNames,e=c.shortestDayNames,f=a.toLowerCase();for(var g=0;g<b.length;g++)if(b[g].toLowerCase()==f||d[g].toLowerCase()==f||e[g].toLowerCase()==f)return g;return -1;};a.getMonthNumberFromName=function(a){var b=c.monthNames,d=c.abbreviatedMonthNames,e=a.toLowerCase();for(var f=0;f<b.length;f++)if(b[f].toLowerCase()==e||d[f].toLowerCase()==e)return f;return -1;};a.isLeapYear=function(a){return((a%4===0&&a%100!==0)||a%400===0);};a.getDaysInMonth=function(b,c){return [31,(a.isLeapYear(b)?29:28),31,30,31,30,31,31,30,31,30,31][c];};a.getTimezoneAbbreviation=function(a){var b=c.timezones,d;for(var e=0;e<b.length;e++)if(b[e].offset===a)return b[e].name;return null;};a.getTimezoneOffset=function(a){var b=c.timezones,d;for(var e=0;e<b.length;e++)if(b[e].name===a.toUpperCase())return b[e].offset;return null;};b.clone=function(){return new Date(this.getTime());};b.compareTo=function(a){return Date.compare(this,a);};b.equals=function(a){return Date.equals(this,a||new Date());};b.between=function(a,b){return this.getTime()>=a.getTime()&&this.getTime()<=b.getTime();};b.isAfter=function(a){return this.compareTo(a||new Date())===1;};b.isBefore=function(a){return(this.compareTo(a||new Date())===-1);};b.isToday=function(){return this.isSameDay(new Date());};b.isSameDay=function(a){return this.clone().clearTime().equals(a.clone().clearTime());};b.addMilliseconds=function(a){this.setMilliseconds(this.getMilliseconds()+a);return this;};b.addSeconds=function(a){return this.addMilliseconds(a*1000);};b.addMinutes=function(a){return this.addMilliseconds(a*60000);};b.addHours=function(a){return this.addMilliseconds(a*3600000);};b.addDays=function(a){this.setDate(this.getDate()+a);return this;};b.addWeeks=function(a){return this.addDays(a*7);};b.addMonths=function(b){var c=this.getDate();this.setDate(1);this.setMonth(this.getMonth()+b);this.setDate(Math.min(c,a.getDaysInMonth(this.getFullYear(),this.getMonth())));return this;};b.addYears=function(a){return this.addMonths(a*12);};b.add=function(a){if(typeof a=="number"){this._orient=a;return this;}var b=a;if(b.milliseconds)this.addMilliseconds(b.milliseconds);if(b.seconds)this.addSeconds(b.seconds);if(b.minutes)this.addMinutes(b.minutes);if(b.hours)this.addHours(b.hours);if(b.weeks)this.addWeeks(b.weeks);if(b.months)this.addMonths(b.months);if(b.years)this.addYears(b.years);if(b.days)this.addDays(b.days);return this;};var e,f,g;b.getWeek=function(){var a,b,c,d,h,i,j,k,l,m;e=(!e)?this.getFullYear():e;f=(!f)?this.getMonth()+1:f;g=(!g)?this.getDate():g;if(f<=2){a=e-1;b=(a/4|0)-(a/100|0)+(a/400|0);c=((a-1)/4|0)-((a-1)/100|0)+((a-1)/400|0);l=b-c;h=0;i=g-1+(31*(f-1));}else{a=e;b=(a/4|0)-(a/100|0)+(a/400|0);c=((a-1)/4|0)-((a-1)/100|0)+((a-1)/400|0);l=b-c;h=l+1;i=g+((153*(f-3)+2)/5)+58+l;}j=(a+b)%7;d=(i+j-h)%7;k=(i+3-d)|0;if(k<0)m=53-((j-l)/5|0);else if(k>364+l)m=1;else m=(k/7|0)+1;e=f=g=null;return m;};b.getISOWeek=function(){e=this.getUTCFullYear();f=this.getUTCMonth()+1;g=this.getUTCDate();return d(this.getWeek());};b.setWeek=function(a){return this.moveToDayOfWeek(1).addWeeks(a-this.getWeek());};a._validate=function(a,b,c,d){if(typeof a=="undefined")return false;else if(typeof a!="number")throw new TypeError(a+" is not a Number.");else if(a<b||a>c)throw new RangeError(a+" is not a valid value for "+d+".");return true;};a.validateMillisecond=function(b){return a._validate(b,0,999,"millisecond");};a.validateSecond=function(b){return a._validate(b,0,59,"second");};a.validateMinute=function(b){return a._validate(b,0,59,"minute");};a.validateHour=function(b){return a._validate(b,0,23,"hour");};a.validateDay=function(b,c,d){return a._validate(b,1,a.getDaysInMonth(c,d),"day");};a.validateMonth=function(b){return a._validate(b,0,11,"month");};a.validateYear=function(b){return a._validate(b,0,9999,"year");};b.set=function(b){if(a.validateMillisecond(b.millisecond))this.addMilliseconds(b.millisecond-this.getMilliseconds());if(a.validateSecond(b.second))this.addSeconds(b.second-this.getSeconds());if(a.validateMinute(b.minute))this.addMinutes(b.minute-this.getMinutes());if(a.validateHour(b.hour))this.addHours(b.hour-this.getHours());if(a.validateMonth(b.month))this.addMonths(b.month-this.getMonth());if(a.validateYear(b.year))this.addYears(b.year-this.getFullYear());if(a.validateDay(b.day,this.getFullYear(),this.getMonth()))this.addDays(b.day-this.getDate());if(b.timezone)this.setTimezone(b.timezone);if(b.timezoneOffset)this.setTimezoneOffset(b.timezoneOffset);if(b.week&&a._validate(b.week,0,53,"week"))this.setWeek(b.week);return this;};b.moveToFirstDayOfMonth=function(){return this.set({day:1});};b.moveToLastDayOfMonth=function(){return this.set({day:a.getDaysInMonth(this.getFullYear(),this.getMonth())});};b.moveToNthOccurrence=function(a,b){var c=0;if(b>0)c=b-1;else if(b===-1){this.moveToLastDayOfMonth();if(this.getDay()!==a)this.moveToDayOfWeek(a,-1);return this;}return this.moveToFirstDayOfMonth().addDays(-1).moveToDayOfWeek(a,+1).addWeeks(c);};b.moveToDayOfWeek=function(a,b){var c=(a-this.getDay()+7*(b||+1))%7;return this.addDays((c===0)?c+=7*(b||+1):c);};b.moveToMonth=function(a,b){var c=(a-this.getMonth()+12*(b||+1))%12;return this.addMonths((c===0)?c+=12*(b||+1):c);};b.getOrdinalNumber=function(){return Math.ceil((this.clone().clearTime()-new Date(this.getFullYear(),0,1))/86400000)+1;};b.getTimezone=function(){return a.getTimezoneAbbreviation(this.getUTCOffset());};b.setTimezoneOffset=function(a){var b=this.getTimezoneOffset(),c=Number(a)*-6/10;return this.addMinutes(c-b);};b.setTimezone=function(b){return this.setTimezoneOffset(a.getTimezoneOffset(b));};b.hasDaylightSavingTime=function(){return(Date.today().set({month:0,day:1}).getTimezoneOffset()!==Date.today().set({month:6,day:1}).getTimezoneOffset());};b.isDaylightSavingTime=function(){return(this.hasDaylightSavingTime()&&new Date().getTimezoneOffset()===Date.today().set({month:6,day:1}).getTimezoneOffset());};b.getUTCOffset=function(){var a=this.getTimezoneOffset()*-10/6,b;if(a<0){b=(a-10000).toString();return b.charAt(0)+b.substr(2);}else{b=(a+10000).toString();return "+"+b.substr(1);}};b.getElapsed=function(a){return(a||new Date())-this;};if(!b.toISOString)b.toISOString=function(){function a(a){return a<10?'0'+a:a;}return '"'+this.getUTCFullYear()+'-'+a(this.getUTCMonth()+1)+'-'+a(this.getUTCDate())+'T'+a(this.getUTCHours())+':'+a(this.getUTCMinutes())+':'+a(this.getUTCSeconds())+'Z"';};b._toString=b.toString;b.toString=function(a){var b=this;if(a&&a.length==1){var e=c.formatPatterns;b.t=b.toString;switch(a){case "d":return b.t(e.shortDate);case "D":return b.t(e.longDate);case "F":return b.t(e.fullDateTime);case "m":return b.t(e.monthDay);case "r":return b.t(e.rfc1123);case "s":return b.t(e.sortableDateTime);case "t":return b.t(e.shortTime);case "T":return b.t(e.longTime);case "u":return b.t(e.universalSortableDateTime);case "y":return b.t(e.yearMonth);}}var f=function(a){switch(a*1){case 1:case 21:case 31:return "st";case 2:case 22:return "nd";case 3:case 23:return "rd";default:return "th";}};return a?a.replace(/(\\)?(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|S)/g,function(a){if(a.charAt(0)==="\\")return a.replace("\\","");b.h=b.getHours;switch(a){case "hh":return d(b.h()<13?(b.h()===0?12:b.h()):(b.h()-12));case "h":return b.h()<13?(b.h()===0?12:b.h()):(b.h()-12);case "HH":return d(b.h());case "H":return b.h();case "mm":return d(b.getMinutes());case "m":return b.getMinutes();case "ss":return d(b.getSeconds());case "s":return b.getSeconds();case "yyyy":return d(b.getFullYear(),4);case "yy":return d(b.getFullYear());case "dddd":return c.dayNames[b.getDay()];case "ddd":return c.abbreviatedDayNames[b.getDay()];case "dd":return d(b.getDate());case "d":return b.getDate();case "MMMM":return c.monthNames[b.getMonth()];case "MMM":return c.abbreviatedMonthNames[b.getMonth()];case "MM":return d((b.getMonth()+1));case "M":return b.getMonth()+1;case "t":return b.h()<12?c.amDesignator.substring(0,1):c.pmDesignator.substring(0,1);case "tt":return b.h()<12?c.amDesignator:c.pmDesignator;case "S":return f(b.getDate());default:return a;}}):this._toString();};}());(function(){var a=Date,b=a.prototype,c=a.CultureInfo,d=Number.prototype;b._orient=+1;b._nth=null;b._is=false;b._same=false;b._isSecond=false;d._dateElement="day";b.next=function(){this._orient=+1;return this;};a.next=function(){return a.today().next();};b.last=b.prev=b.previous=function(){this._orient=-1;return this;};a.last=a.prev=a.previous=function(){return a.today().last();};b.is=function(){this._is=true;return this;};b.same=function(){this._same=true;this._isSecond=false;return this;};b.today=function(){return this.same().day();};b.weekday=function(){if(this._is){this._is=false;return(!this.is().sat()&&!this.is().sun());}return false;};b.at=function(b){return(typeof b==="string")?a.parse(this.toString("d")+" "+b):this.set(b);};d.fromNow=d.after=function(a){var b={};b[this._dateElement]=this;return((!a)?new Date():a.clone()).add(b);};d.ago=d.before=function(a){var b={};b[this._dateElement]=this*-1;return((!a)?new Date():a.clone()).add(b);};var e="sunday monday tuesday wednesday thursday friday saturday".split(/\s/),f="january february march april may june july august september october november december".split(/\s/),g="Millisecond Second Minute Hour Day Week Month Year".split(/\s/),h="Milliseconds Seconds Minutes Hours Date Week Month FullYear".split(/\s/),i="final first second third fourth fifth".split(/\s/),j;b.toObject=function(){var a={};for(var b=0;b<g.length;b++)a[g[b].toLowerCase()]=this["get"+h[b]]();return a;};a.fromObject=function(a){a.week=null;return Date.today().set(a);};var k=function(b){return function(){if(this._is){this._is=false;return this.getDay()==b;}if(this._nth!==null){if(this._isSecond)this.addSeconds(this._orient*-1);this._isSecond=false;var c=this._nth;this._nth=null;var d=this.clone().moveToLastDayOfMonth();this.moveToNthOccurrence(b,c);if(this>d)throw new RangeError(a.getDayName(b)+" does not occur "+c+" times in the month of "+a.getMonthName(d.getMonth())+" "+d.getFullYear()+".");return this;}return this.moveToDayOfWeek(b,this._orient);};};var l=function(b){return function(){var d=a.today(),e=b-d.getDay();if(b===0&&c.firstDayOfWeek===1&&d.getDay()!==0)e=e+7;return d.addDays(e);};};for(var m=0;m<e.length;m++){a[e[m].toUpperCase()]=a[e[m].toUpperCase().substring(0,3)]=m;a[e[m]]=a[e[m].substring(0,3)]=l(m);b[e[m]]=b[e[m].substring(0,3)]=k(m);}var n=function(a){return function(){if(this._is){this._is=false;return this.getMonth()===a;}return this.moveToMonth(a,this._orient);};};var o=function(b){return function(){return a.today().set({month:b,day:1});};};for(var p=0;p<f.length;p++){a[f[p].toUpperCase()]=a[f[p].toUpperCase().substring(0,3)]=p;a[f[p]]=a[f[p].substring(0,3)]=o(p);b[f[p]]=b[f[p].substring(0,3)]=n(p);}var q=function(a){return function(){if(this._isSecond){this._isSecond=false;return this;}if(this._same){this._same=this._is=false;var b=this.toObject(),c=(arguments[0]||new Date()).toObject(),d="",e=a.toLowerCase();for(var f=(g.length-1);f>-1;f--){d=g[f].toLowerCase();if(b[d]!=c[d])return false;if(e==d)break;}return true;}if(a.substring(a.length-1)!="s")a+="s";return this["add"+a](this._orient);};};var r=function(a){return function(){this._dateElement=a;return this;};};for(var s=0;s<g.length;s++){j=g[s].toLowerCase();b[j]=b[j+"s"]=q(g[s]);d[j]=d[j+"s"]=r(j);}b._ss=q("Second");var t=function(a){return function(b){if(this._same)return this._ss(arguments[0]);if(b||b===0)return this.moveToNthOccurrence(b,a);this._nth=a;if(a===2&&(b===undefined||b===null)){this._isSecond=true;return this.addSeconds(this._orient);}return this;};};for(var u=0;u<i.length;u++)b[i[u]]=(u===0)?t(-1):t(u);}());(function(){Date.Parsing={Exception:function(a){this.message="Parse error at '"+a.substring(0,10)+" ...'";}};var a=Date.Parsing;var b=a.Operators={rtoken:function(b){return function(c){var d=c.match(b);if(d)return [d[0],c.substring(d[0].length)];else throw new a.Exception(c);};},token:function(a){return function(a){return b.rtoken(new RegExp("^\s*"+a+"\s*"))(a);};},stoken:function(a){return b.rtoken(new RegExp("^"+a));},until:function(a){return function(b){var c=[],d=null;while(b.length){try{d=a.call(this,b);}catch(e){c.push(d[0]);b=d[1];continue;}break;}return [c,b];};},many:function(a){return function(b){var c=[],d=null;while(b.length){try{d=a.call(this,b);}catch(e){return [c,b];}c.push(d[0]);b=d[1];}return [c,b];};},optional:function(a){return function(b){var c=null;try{c=a.call(this,b);}catch(d){return [null,b];}return [c[0],c[1]];};},not:function(b){return function(c){try{b.call(this,c);}catch(d){return [null,c];}throw new a.Exception(c);};},ignore:function(a){return a?function(b){var c=null;c=a.call(this,b);return [null,c[1]];}:null;},product:function(){var a=arguments[0],c=Array.prototype.slice.call(arguments,1),d=[];for(var e=0;e<a.length;e++)d.push(b.each(a[e],c));return d;},cache:function(b){var c={},d=null;return function(e){try{d=c[e]=(c[e]||b.call(this,e));}catch(f){d=c[e]=f;}if(d instanceof a.Exception)throw d;else return d;};},any:function(){var b=arguments;return function(c){var d=null;for(var e=0;e<b.length;e++){if(b[e]==null)continue;try{d=(b[e].call(this,c));}catch(f){d=null;}if(d)return d;}throw new a.Exception(c);};},each:function(){var b=arguments;return function(c){var d=[],e=null;for(var f=0;f<b.length;f++){if(b[f]==null)continue;try{e=(b[f].call(this,c));}catch(g){throw new a.Exception(c);}d.push(e[0]);c=e[1];}return [d,c];};},all:function(){var a=arguments,b=b;return b.each(b.optional(a));},sequence:function(c,d,e){d=d||b.rtoken(/^\s*/);e=e||null;if(c.length==1)return c[0];return function(b){var f=null,g=null;var h=[];for(var i=0;i<c.length;i++){try{f=c[i].call(this,b);}catch(j){break;}h.push(f[0]);try{g=d.call(this,f[1]);}catch(k){g=null;break;}b=g[1];}if(!f)throw new a.Exception(b);if(g)throw new a.Exception(g[1]);if(e)try{f=e.call(this,f[1]);}catch(l){throw new a.Exception(f[1]);}return [h,(f?f[1]:b)];};},between:function(a,c,d){d=d||a;var e=b.each(b.ignore(a),c,b.ignore(d));return function(a){var b=e.call(this,a);return [[b[0][0],r[0][2]],b[1]];};},list:function(a,c,d){c=c||b.rtoken(/^\s*/);d=d||null;return(a instanceof Array?b.each(b.product(a.slice(0,-1),b.ignore(c)),a.slice(-1),b.ignore(d)):b.each(b.many(b.each(a,b.ignore(c))),px,b.ignore(d)));},set:function(c,d,e){d=d||b.rtoken(/^\s*/);e=e||null;return function(f){var g=null,h=null,i=null,j=null,k=[[],f],l=false;for(var m=0;m<c.length;m++){i=null;h=null;g=null;l=(c.length==1);try{g=c[m].call(this,f);}catch(n){continue;}j=[[g[0]],g[1]];if(g[1].length>0&&!l)try{i=d.call(this,g[1]);}catch(o){l=true;}else l=true;if(!l&&i[1].length===0)l=true;if(!l){var p=[];for(var q=0;q<c.length;q++)if(m!=q)p.push(c[q]);h=b.set(p,d).call(this,i[1]);if(h[0].length>0){j[0]=j[0].concat(h[0]);j[1]=h[1];}}if(j[1].length<k[1].length)k=j;if(k[1].length===0)break;}if(k[0].length===0)return k;if(e){try{i=e.call(this,k[1]);}catch(r){throw new a.Exception(k[1]);}k[1]=i[1];}return k;};},forward:function(a,b){return function(c){return a[b].call(this,c);};},replace:function(a,b){return function(c){var d=a.call(this,c);return [b,d[1]];};},process:function(a,b){return function(c){var d=a.call(this,c);return [b.call(this,d[0]),d[1]];};},min:function(b,c){return function(d){var e=c.call(this,d);if(e[0].length<b)throw new a.Exception(d);return e;};}};var c=function(a){return function(){var b=null,c=[];if(arguments.length>1)b=Array.prototype.slice.call(arguments);else if(arguments[0] instanceof Array)b=arguments[0];if(b)for(var d=0,e=b.shift();d<e.length;d++){b.unshift(e[d]);c.push(a.apply(null,b));b.shift();return c;}else return a.apply(null,arguments);};};var d="optional not ignore cache".split(/\s/);for(var e=0;e<d.length;e++)b[d[e]]=c(b[d[e]]);var f=function(a){return function(){if(arguments[0] instanceof Array)return a.apply(null,arguments[0]);else return a.apply(null,arguments);};};var g="each any all".split(/\s/);for(var h=0;h<g.length;h++)b[g[h]]=f(b[g[h]]);}());(function(){var a=Date,b=a.prototype,c=a.CultureInfo;var d=function(a){var b=[];for(var c=0;c<a.length;c++)if(a[c] instanceof Array)b=b.concat(d(a[c]));else if(a[c])b.push(a[c]);return b;};a.Grammar={};a.Translator={hour:function(a){return function(){this.hour=Number(a);};},minute:function(a){return function(){this.minute=Number(a);};},second:function(a){return function(){this.second=Number(a);};},meridian:function(a){return function(){this.meridian=a.slice(0,1).toLowerCase();};},timezone:function(a){return function(){var b=a.replace(/[^\d\+\-]/g,"");if(b.length)this.timezoneOffset=Number(b);else this.timezone=a.toLowerCase();};},day:function(a){var b=a[0];return function(){this.day=Number(b.match(/\d+/)[0]);};},month:function(a){return function(){this.month=(a.length==3)?"jan feb mar apr may jun jul aug sep oct nov dec".indexOf(a)/4:Number(a)-1;};},year:function(a){return function(){var b=Number(a);this.year=((a.length>2)?b:(b+(((b+2000)<c.twoDigitYearMax)?2000:1900)));};},rday:function(a){return function(){switch(a){case "yesterday":this.days=-1;break;case "tomorrow":this.days=1;break;case "today":this.days=0;break;case "now":this.days=0;this.now=true;break;}};},finishExact:function(b){b=(b instanceof Array)?b:[b];for(var c=0;c<b.length;c++)if(b[c])b[c].call(this);var d=new Date();if((this.hour||this.minute)&&(!this.month&&!this.year&&!this.day))this.day=d.getDate();if(!this.year)this.year=d.getFullYear();if(!this.month&&this.month!==0)this.month=d.getMonth();if(!this.day)this.day=1;if(!this.hour)this.hour=0;if(!this.minute)this.minute=0;if(!this.second)this.second=0;if(this.meridian&&this.hour)if(this.meridian=="p"&&this.hour<12)this.hour=this.hour+12;else if(this.meridian=="a"&&this.hour==12)this.hour=0;if(this.day>a.getDaysInMonth(this.year,this.month))throw new RangeError(this.day+" is not a valid value for days.");var e=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second);if(this.timezone)e.set({timezone:this.timezone});else if(this.timezoneOffset)e.set({timezoneOffset:this.timezoneOffset});return e;},finish:function(b){b=(b instanceof Array)?d(b):[b];if(b.length===0)return null;for(var c=0;c<b.length;c++)if(typeof b[c]=="function")b[c].call(this);var e=a.today();if(this.now&&!this.unit&&!this.operator)return new Date();else if(this.now)e=new Date();var f=!!(this.days&&this.days!==null||this.orient||this.operator);var g,h,i;i=((this.orient=="past"||this.operator=="subtract")?-1:1);if(!this.now&&"hour minute second".indexOf(this.unit)!=-1)e.setTimeToNow();if(this.month||this.month===0)if("year day hour minute second".indexOf(this.unit)!=-1){this.value=this.month+1;this.month=null;f=true;}if(!f&&this.weekday&&!this.day&&!this.days){var j=Date[this.weekday]();this.day=j.getDate();if(!this.month)this.month=j.getMonth();this.year=j.getFullYear();}if(f&&this.weekday&&this.unit!="month"){this.unit="day";g=(a.getDayNumberFromName(this.weekday)-e.getDay());h=7;this.days=g?((g+(i*h))%h):(i*h);}if(this.month&&this.unit=="day"&&this.operator){this.value=(this.month+1);this.month=null;}if(this.value!=null&&this.month!=null&&this.year!=null)this.day=this.value*1;if(this.month&&!this.day&&this.value){e.set({day:this.value*1});if(!f)this.day=this.value*1;}if(!this.month&&this.value&&this.unit=="month"&&!this.now){this.month=this.value;f=true;}if(f&&(this.month||this.month===0)&&this.unit!="year"){this.unit="month";g=(this.month-e.getMonth());h=12;this.months=g?((g+(i*h))%h):(i*h);this.month=null;}if(!this.unit)this.unit="day";if(!this.value&&this.operator&&this.operator!==null&&this[this.unit+"s"]&&this[this.unit+"s"]!==null)this[this.unit+"s"]=this[this.unit+"s"]+((this.operator=="add")?1:-1)+(this.value||0)*i;else if(this[this.unit+"s"]==null||this.operator!=null){if(!this.value)this.value=1;this[this.unit+"s"]=this.value*i;}if(this.meridian&&this.hour)if(this.meridian=="p"&&this.hour<12)this.hour=this.hour+12;else if(this.meridian=="a"&&this.hour==12)this.hour=0;if(this.weekday&&!this.day&&!this.days){var j=Date[this.weekday]();this.day=j.getDate();if(j.getMonth()!==e.getMonth())this.month=j.getMonth();}if((this.month||this.month===0)&&!this.day)this.day=1;if(!this.orient&&!this.operator&&this.unit=="week"&&this.value&&!this.day&&!this.month)return Date.today().setWeek(this.value);if(f&&this.timezone&&this.day&&this.days)this.day=this.days;return f?e.add(this):e.set(this);}};var e=a.Parsing.Operators,f=a.Grammar,g=a.Translator,h;f.datePartDelimiter=e.rtoken(/^([\s\-\.\,\/\x27]+)/);f.timePartDelimiter=e.stoken(":");f.whiteSpace=e.rtoken(/^\s*/);f.generalDelimiter=e.rtoken(/^(([\s\,]|at|@|on)+)/);var i={};f.ctoken=function(a){var b=i[a];if(!b){var d=c.regexPatterns;var f=a.split(/\s+/),g=[];for(var h=0;h<f.length;h++)g.push(e.replace(e.rtoken(d[f[h]]),f[h]));b=i[a]=e.any.apply(null,g);}return b;};f.ctoken2=function(a){return e.rtoken(c.regexPatterns[a]);};f.h=e.cache(e.process(e.rtoken(/^(0[0-9]|1[0-2]|[1-9])/),g.hour));f.hh=e.cache(e.process(e.rtoken(/^(0[0-9]|1[0-2])/),g.hour));f.H=e.cache(e.process(e.rtoken(/^([0-1][0-9]|2[0-3]|[0-9])/),g.hour));f.HH=e.cache(e.process(e.rtoken(/^([0-1][0-9]|2[0-3])/),g.hour));f.m=e.cache(e.process(e.rtoken(/^([0-5][0-9]|[0-9])/),g.minute));f.mm=e.cache(e.process(e.rtoken(/^[0-5][0-9]/),g.minute));f.s=e.cache(e.process(e.rtoken(/^([0-5][0-9]|[0-9])/),g.second));f.ss=e.cache(e.process(e.rtoken(/^[0-5][0-9]/),g.second));f.hms=e.cache(e.sequence([f.H,f.m,f.s],f.timePartDelimiter));f.t=e.cache(e.process(f.ctoken2("shortMeridian"),g.meridian));f.tt=e.cache(e.process(f.ctoken2("longMeridian"),g.meridian));f.z=e.cache(e.process(e.rtoken(/^((\+|\-)\s*\d\d\d\d)|((\+|\-)\d\d\:?\d\d)/),g.timezone));f.zz=e.cache(e.process(e.rtoken(/^((\+|\-)\s*\d\d\d\d)|((\+|\-)\d\d\:?\d\d)/),g.timezone));f.zzz=e.cache(e.process(f.ctoken2("timezone"),g.timezone));f.timeSuffix=e.each(e.ignore(f.whiteSpace),e.set([f.tt,f.zzz]));f.time=e.each(e.optional(e.ignore(e.stoken("T"))),f.hms,f.timeSuffix);f.d=e.cache(e.process(e.each(e.rtoken(/^([0-2]\d|3[0-1]|\d)/),e.optional(f.ctoken2("ordinalSuffix"))),g.day));f.dd=e.cache(e.process(e.each(e.rtoken(/^([0-2]\d|3[0-1])/),e.optional(f.ctoken2("ordinalSuffix"))),g.day));f.ddd=f.dddd=e.cache(e.process(f.ctoken("sun mon tue wed thu fri sat"),function(a){return function(){this.weekday=a;};}));f.M=e.cache(e.process(e.rtoken(/^(1[0-2]|0\d|\d)/),g.month));f.MM=e.cache(e.process(e.rtoken(/^(1[0-2]|0\d)/),g.month));f.MMM=f.MMMM=e.cache(e.process(f.ctoken("jan feb mar apr may jun jul aug sep oct nov dec"),g.month));f.y=e.cache(e.process(e.rtoken(/^(\d\d?)/),g.year));f.yy=e.cache(e.process(e.rtoken(/^(\d\d)/),g.year));f.yyy=e.cache(e.process(e.rtoken(/^(\d\d?\d?\d?)/),g.year));f.yyyy=e.cache(e.process(e.rtoken(/^(\d\d\d\d)/),g.year));h=function(){return e.each(e.any.apply(null,arguments),e.not(f.ctoken2("timeContext")));};f.day=h(f.d,f.dd);f.month=h(f.M,f.MMM);f.year=h(f.yyyy,f.yy);f.orientation=e.process(f.ctoken("past future"),function(a){return function(){this.orient=a;};});f.operator=e.process(f.ctoken("add subtract"),function(a){return function(){this.operator=a;};});f.rday=e.process(f.ctoken("yesterday tomorrow today now"),g.rday);f.unit=e.process(f.ctoken("second minute hour day week month year"),function(a){return function(){this.unit=a;};});f.value=e.process(e.rtoken(/^\d\d?(st|nd|rd|th)?/),function(a){return function(){this.value=a.replace(/\D/g,"");};});f.expression=e.set([f.rday,f.operator,f.value,f.unit,f.orientation,f.ddd,f.MMM]);h=function(){return e.set(arguments,f.datePartDelimiter);};f.mdy=h(f.ddd,f.month,f.day,f.year);f.ymd=h(f.ddd,f.year,f.month,f.day);f.dmy=h(f.ddd,f.day,f.month,f.year);f.date=function(a){return((f[c.dateElementOrder]||f.mdy).call(this,a));};f.format=e.process(e.many(e.any(e.process(e.rtoken(/^(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|zz?z?)/),function(b){if(f[b])return f[b];else throw a.Parsing.Exception(b);}),e.process(e.rtoken(/^[^dMyhHmstz]+/),function(a){return e.ignore(e.stoken(a));}))),function(a){return e.process(e.each.apply(null,a),g.finishExact);});var j={};var k=function(a){return j[a]=(j[a]||f.format(a)[0]);};f.formats=function(a){if(a instanceof Array){var b=[];for(var c=0;c<a.length;c++)b.push(k(a[c]));return e.any.apply(null,b);}else return k(a);};f._formats=f.formats(["yyyyMMdd","\"yyyy-MM-ddTHH:mm:ssZ\"","yyyy-MM-ddTHH:mm:ssZ","yyyy-MM-ddTHH:mm:ssz","yyyy-MM-ddTHH:mm:ss","yyyy-MM-ddTHH:mmZ","yyyy-MM-ddTHH:mmz","yyyy-MM-ddTHH:mm","ddd, MMM dd, yyyy H:mm:ss tt","ddd MMM d yyyy HH:mm:ss zzz","MMddyyyy","ddMMyyyy","Mddyyyy","ddMyyyy","Mdyyyy","dMyyyy","yyyy","Mdyy","dMyy","d"]);f._start=e.process(e.set([f.date,f.time,f.expression],f.generalDelimiter,f.whiteSpace),g.finish);f.start=function(a){try{var b=f._formats.call({},a);if(b[1].length===0)return b;}catch(c){}return f._start.call({},a);};a._parse=a.parse;a.parse=function(b){var c=null;if(!b)return null;if(b instanceof Date)return b;try{c=a.Grammar.start.call({},b.replace(/^\s*(\S*(\s+\S+)*)\s*$/,"$1"));}catch(d){return null;}return((c[1].length===0)?c[0]:null);};a.getParseFunction=function(b){var c=a.Grammar.formats(b);return function(a){var b=null;try{b=c.call({},a);}catch(d){return null;}return((b[1].length===0)?b[0]:null);};};a.parseExact=function(b,c){return a.getParseFunction(c)(b);};}());